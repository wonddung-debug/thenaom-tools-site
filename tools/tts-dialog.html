<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ â€” ì—­í•  ë‚­ë… ë„êµ¬ (í•œêµ­ì–´)</title>
  <meta name="description" content="BYO Google TTS. ì—­í•  ëŒ€í™”/ì¼ë°˜/ì„¸ë°€ ì¡°ì ˆ. ìë™ ì €ì¥ ì˜µì…˜, ì–¸ì–´ë³„ ë³´ì´ìŠ¤ ë¯¸ë¦¬ë“£ê¸°, ê¸´ ê¸€ ìë™ ë‚˜ëˆ”. ì‚¬ì´íŠ¸ ê³µí†µ UI/í…Œë§ˆ í†µì¼." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="/tools/tts-dialog.html" />
  <link rel="alternate" hreflang="ko" href="/tools/tts-dialog.html" />
  <link rel="alternate" hreflang="en" href="/en/tools/tts-dialog.html" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
  <meta property="og:title" content="ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ â€” ì—­í•  ë‚­ë… ë„êµ¬ (í•œêµ­ì–´)" />
  <meta property="og:description" content="Google Cloud TTSë¡œ ë‚´ APIí‚¤ë¡œ í•©ì„±. ì—­í•  ëŒ€í™”/ì¼ë°˜/ì„¸ë°€ ì¡°ì ˆ, ê¸´ ê¸€ ìë™ ë‚˜ëˆ”, ì–¸ì–´ë³„ ë³´ì´ìŠ¤ ìƒ˜í”Œ." />
  <meta property="og:image" content="/assets/og-tool-tts-dialog.png" />
  <meta property="og:url" content="/tools/tts-dialog.html" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ko_KR" />

  <!-- Theme bootstrap (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <script>
    (function(){
      try{
        const saved=localStorage.getItem('theme');
        if(saved==='light'||saved==='dark'){
          document.documentElement.setAttribute('data-theme',saved);
          document.documentElement.setAttribute('data-user-theme','1');
        }else{
          const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
          document.documentElement.setAttribute('data-theme',prefersDark?'dark':'light');
        }
      }catch(e){}
    })();
  </script>

  <!-- GTM (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-N2BBPNCC');</script>

  <!-- AdSense (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3006330103681332" crossorigin="anonymous"></script>

  <!-- ê³µí†µ ìŠ¤íƒ€ì¼ í† í° (ì‚¬ì´íŠ¸ ê³µí†µ ë²„íŠ¼/ë ˆì´ì•„ì›ƒê³¼ í†µì¼) -->
  <style>
    :root{ --bg:#ffffff; --text:#0b1220; --muted:#475569; --border:#e5e7eb; --card:#ffffff; --accent:#2563eb; --btn-text:#ffffff; --shadow:0 6px 18px rgba(0,0,0,.06); --focus: color-mix(in srgb, var(--accent) 35%, transparent); --input:#0b1220; --input-bg:var(--card); --hero-tint:#eff3ff; --hero-grid:#e8ecf6; --hero-ring:#cfe1ff }
    [data-theme="dark"]{ --bg:#0b1220; --text:#f1f5f9; --muted:#cbd5e1; --border:#334155; --card:#111827; --accent:#60a5fa; --btn-text:#0b1220; --shadow:0 8px 22px rgba(0,0,0,.55); --focus: color-mix(in srgb, var(--accent) 45%, transparent); --input:#e5e7eb; --input-bg:#0f172a; --hero-tint:#0f172a; --hero-grid:#162036; --hero-ring:#1f3b76 }
    html,body{background:var(--bg)!important}
    body{color:var(--text)!important;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}

    /* Header ê³µí†µ */
    header.site{position:sticky;top:0;z-index:100;background:var(--bg)!important;border-bottom:1px solid var(--border)}
    .brand{color:var(--text)!important;font-weight:800;text-decoration:none}
    header.site nav{display:flex;align-items:center;gap:12px}
    .lang-switch,.theme-toggle,.btn{padding:.5rem .72rem;border:1px solid var(--border);border-radius:.7rem;background:linear-gradient(180deg,color-mix(in srgb,var(--card)96%,transparent),var(--card));cursor:pointer;color:var(--text)!important;box-shadow:var(--shadow);transition:transform .06s,box-shadow .18s,border-color .18s,background .18s}
    .lang-switch:hover,.theme-toggle:hover,.theme-toggle:focus-visible,.btn:hover{color:var(--accent)!important;border-color:var(--accent)!important;box-shadow:0 0 0 3px var(--focus), var(--shadow)}
    .theme-toggle:active,.btn:active{transform:translateY(1px)}
    .theme-toggle[aria-pressed="true"], .btn-primary{background:linear-gradient(180deg,color-mix(in srgb,var(--accent)22%,var(--card)),var(--accent));border-color:var(--accent)!important;color:var(--btn-text)!important}
    .btn-secondary{background:linear-gradient(180deg, color-mix(in srgb, var(--card) 95%, transparent), var(--card))}
    .btn-danger{background:linear-gradient(180deg,color-mix(in srgb,#ef4444 20%,var(--card)),#ef4444);border-color:#ef4444;color:#fff}

    /* Hero ê³µí†µ */
    .hero{position:relative;overflow:hidden;padding:28px 0 18px;text-align:start;isolation:isolate}
    .hero::before{content:"";position:absolute;inset:0;background:radial-gradient(900px 360px at 50% -15%, var(--hero-ring), transparent 65%),linear-gradient(180deg, color-mix(in srgb, var(--hero-tint) 88%, transparent), transparent 60%);z-index:-2}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(to right, color-mix(in srgb,var(--hero-grid) 35%, transparent) 1px, transparent 1px) 0 0/28px 28px,linear-gradient(to bottom, color-mix(in srgb,var(--hero-grid) 35%, transparent) 1px, transparent 1px) 0 0/28px 28px;opacity:.5;z-index:-1}
    .hero h1{margin:0;font-size:clamp(1.6rem,3.4vw,2.2rem)} .hero p{margin:.4rem 0 0;color:var(--muted);max-width:900px}
    .crumb{margin:10px 0 0;font-size:.95rem}.crumb a{color:var(--muted)} .hl{background:color-mix(in srgb, var(--accent) 14%, transparent);padding:0 4px;border-radius:6px}

    /* Panels ê³µí†µ */
    main .section{margin:12px 0}
    .ad-space{margin:8px 0}
    .panel{border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg, color-mix(in srgb, var(--card) 95%, transparent), var(--card));box-shadow:var(--shadow);padding:12px}
    .panel h2{margin:.1rem 0 .6rem;font-size:1.06rem}
    .panel h3{margin:1rem 0 .6rem;font-size:1rem}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.row{grid-template-columns:1fr 1fr}}
    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .small{font-size:.92rem;color:var(--muted)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}

    /* Inputs */
    textarea.input{width:100%;min-height:400px;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--input-bg);color:var(--input);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.98rem;line-height:1.45;resize:vertical;white-space:pre-wrap}
    textarea.output{width:100%;min-height:220px;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.98rem;line-height:1.45;resize:vertical}
    select,input[type=text],input[type=password],input[type=number]{width:100%;padding:.6rem .72rem;border:1px solid var(--border);border-radius:.7rem;background:var(--input-bg);color:var(--input)}

    /* Tables & lists */
    .list{max-height:320px;overflow:auto;border:1px dashed var(--border);border-radius:10px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border);padding:6px 8px;text-align:left}

    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted)}
    .counter{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:.92rem;margin-top:6px}
  
    /* ìƒˆë¡œìš´ ë©”ì¸ ë ˆì´ì•„ì›ƒ - ì¢Œìš° ë¶„í•  */
    .main-layout{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:768px){.main-layout{grid-template-columns:2fr 1fr}}
    
    .left-section{display:flex;flex-direction:column;gap:12px}
    .right-section{display:flex;flex-direction:column;gap:12px}
    
    .role-table-container{overflow-x:auto}
    .role-table{min-width:800px;width:100%}
    
    .options-grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:600px){.options-grid{grid-template-columns:1fr 1fr}}
    
    .voice-options{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .voice-options label{min-width:80px;flex-shrink:0;font-size:0.9rem}
    .voice-options select{min-width:200px;flex:1}
    
    .chunk-options{margin-top:10px;padding:10px;border:1px solid var(--border);border-radius:8px;background:color-mix(in srgb,var(--card) 95%,transparent)}
    
    /* ì§„í–‰ ìƒíƒœ ë°” */
    .progress-bar{height:4px;background:var(--border);border-radius:2px;overflow:hidden;margin:8px 0}
    .progress-fill{height:100%;background:var(--accent);transition:width 0.3s ease}
    
    /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .error-msg{background:color-mix(in srgb,#ef4444 15%,transparent);border:1px solid #ef4444;border-radius:8px;padding:10px;margin:10px 0;color:var(--text)}
    .warning-msg{background:color-mix(in srgb,#f59e0b 15%,transparent);border:1px solid #f59e0b;border-radius:8px;padding:10px;margin:10px 0;color:var(--text)}
    
    /* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
    .slider-container{display:flex;align-items:center;gap:8px;margin:8px 0}
    .slider{flex:1;height:6px;border-radius:3px;background:var(--border);appearance:none;outline:none}
    .slider::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:var(--accent);cursor:pointer}
    .slider::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--accent);cursor:pointer;border:none}
    .slider-value{min-width:60px;text-align:center;font-family:monospace;font-size:0.9rem}
    
    /* ëª©ì†Œë¦¬ ì •ë³´ ìŠ¤íƒ€ì¼ */
    .voice-info{font-size:0.85rem;color:var(--muted);margin-top:2px}
    .voice-tag{display:inline-block;padding:1px 6px;margin:0 2px;border-radius:4px;font-size:0.75rem;font-weight:500}
    .voice-tag.female{background:color-mix(in srgb,#ec4899 20%,transparent);color:#be185d}
    .voice-tag.male{background:color-mix(in srgb,#3b82f6 20%,transparent);color:#1d4ed8}
    .voice-tag.neutral{background:color-mix(in srgb,#6b7280 20%,transparent);color:#374151}
    .voice-tag.premium{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#d97706}
    .voice-tag.standard{background:color-mix(in srgb,#10b981 20%,transparent);color:#047857}
    .voice-tag.latest{background:color-mix(in srgb,#8b5cf6 20%,transparent);color:#7c3aed}
    
    /* ì„¤ì • ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
    .setting-group{margin-bottom:16px}
    .setting-group label{display:block;margin-bottom:4px;font-size:0.9rem;font-weight:500}
    .setting-group select{width:100%}
    
    /* ë°˜ì‘í˜• ê°œì„  */
    @media(max-width:767px){
      .voice-options{flex-direction:column;align-items:stretch}
      .voice-options label{min-width:auto}
      .voice-options select{min-width:auto}
    }
  </style>
</head>
<body>
  <!-- GTM (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N2BBPNCC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Header (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <header class="site">
    <div class="container" style="display:flex;justify-content:space-between;align-items:center">
      <a href="/" class="brand">Thenaom Tools</a>
      <nav aria-label="ë³´ì¡° íƒìƒ‰">
        <a class="lang-switch" href="/en/tools/tts-dialog.html" hreflang="en">English</a>
        <button id="themeToggle" class="theme-toggle" aria-pressed="false" title="í…Œë§ˆ ì „í™˜"><span class="icon">ğŸŒ</span><span class="label">ë¼ì´íŠ¸</span></button>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <div class="crumb"><a href="/">í™ˆ</a> &nbsp;>&nbsp; <a href="/audio/">ì˜¤ë””ì˜¤</a> &nbsp;>&nbsp; ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ</div>
      <h1>ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ â€” <span class="hl">ì—­í•  ë‚­ë… ë„êµ¬</span> (í•œêµ­ì–´)</h1>
      <p>ë‚´ Google Cloud TTS <span class="hl">API í‚¤</span>ë¡œ, ëŒ€í™”ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í•©ì„±í•©ë‹ˆë‹¤. <b>ì—­í•  ëŒ€í™”/ì¼ë°˜/ì„¸ë°€ ì¡°ì ˆ</b>ì„ ì§€ì›í•˜ê³ , <b>ê¸´ ê¸€ ìë™ ë‚˜ëˆ”</b>ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì´ì–´ë¶™ì…ë‹ˆë‹¤.</p>
    </div>
  </section>

  <main class="container" id="main">
    <!-- ìƒë‹¨ ê´‘ê³  -->
    <div class="ad-space"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3006330103681332" data-ad-slot="6703005412" data-ad-format="auto" data-full-width-responsive="true"></ins></div>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>

    <!-- ë¯¸ë‹ˆ ìƒíƒœì¤„: API ì €ì¥ ì—¬ë¶€ -->
    <section class="section">
      <div class="panel" id="miniBar" style="display:flex;align-items:center;gap:10px;justify-content:space-between">
        <div class="controls">
          <span id="apiBadge" class="btn" style="pointer-events:none">API ì…ë ¥ í•„ìš”</span>
          <span class="small" id="apiMiniText">API í‚¤ë¥¼ ì €ì¥í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”</span>
        </div>
        <div class="controls small">
          <span>ëª¨ë“œ: <b id="modeMini">ì—­í•  ëŒ€í™”</b></span>
        </div>
      </div>
    </section>

    <!-- ë©”ì¸ ì»¨í…ì¸  ë ˆì´ì•„ì›ƒ - ì¢Œìš° ë¶„í•  -->
    <section class="section">
      <div class="main-layout">
        <!-- ì™¼ìª½ ì„¹ì…˜: í…ìŠ¤íŠ¸ ì…ë ¥ ë° ì—­í•  ê´€ë¦¬ -->
        <div class="left-section">
          <!-- ëª¨ë“œ ì„ íƒ -->
          <div class="panel">
            <h2>ëª¨ë“œ ì„ íƒ</h2>
            <div class="controls" style="margin-bottom:8px">
              <div role="tablist" aria-label="ëª¨ë“œ" class="controls" id="modeChips">
                <button class="btn btn-secondary" data-val="plain" aria-pressed="false">ì¼ë°˜</button>
                <button class="btn btn-primary" data-val="dialog" aria-pressed="true">ì—­í•  ëŒ€í™”</button>
                <button class="btn btn-secondary" data-val="ssml" aria-pressed="false">ì„¸ë°€ ì¡°ì ˆ(ì „ë¬¸ê°€ìš©)</button>
              </div>
            </div>
            <div class="small" id="modeHint" style="color:var(--muted)">ì—­í•  ëŒ€í™”: ì¤„ ì•ì— "ì´ë¦„: ë‚´ìš©" ë˜ëŠ” "[ì´ë¦„] ë‚´ìš©"</div>
          </div>

          <!-- í…ìŠ¤íŠ¸ ì…ë ¥ -->
          <div class="panel">
            <h2>í…ìŠ¤íŠ¸ ì…ë ¥</h2>
            <textarea id="editor" class="input mono" placeholder="ì˜ˆ: í• ë¨¸ë‹ˆ: ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì.&#10;ì†Œë…„: ì•„ì§ í•  ë§ì´ ìˆì–´ìš”!"></textarea>
            <div class="counter" id="counter">0 ê¸€ì / 0 ë°”ì´íŠ¸</div>

            <!-- ê¸´ ê¸€ ìë™ ë‚˜ëˆ” ì˜µì…˜ -->
            <div class="chunk-options">
              <div class="controls">
                <label for="chunkTgl" class="small" style="min-width:160px">ê¸´ ê¸€ ìë™ ë‚˜ëˆ”</label>
                <button id="chunkTgl" class="btn btn-primary" aria-pressed="true">ON</button>
              </div>
              <div class="small" style="margin-top:6px">ìš”ì²­ 1íšŒë‹¹ <b>5,000ë°”ì´íŠ¸</b> ì œí•œ. <b>í•œê¸€ ê¸°ì¤€ ëŒ€ëµ 1,600ì</b>ë¥¼ ë„˜ìœ¼ë©´ <b>ì˜¤ë¥˜</b>ê°€ ë‚  ìˆ˜ ìˆì–´ìš”. ì´ ê¸°ëŠ¥ì„ <b>ì¼œë‘ë©´</b> ê¸¸ì´ë¥¼ ìë™ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì„œ ì´ì–´ë¶™ì…ë‹ˆë‹¤.</div>
            </div>
          </div>

          <!-- ì—­í•  ëŒ€í™” ì „ìš© ì˜µì…˜ -->
          <div class="panel" id="dialogOptions" style="display:block">
            <h2>ì—­í•  ëŒ€í™” ì„¤ì •</h2>
            
            <!-- ëŒ€í™” ì˜µì…˜ -->
            <div class="options-grid">
              <div class="setting-group">
                <label>ë§ ë°”ë€” ë•Œ ì ê¹ ì‰¬ê¸°</label>
                <select id="switchSelect">
                  <option value="0">0ms - ë°”ë¡œ ì´ì–´ì„œ</option>
                  <option value="150" selected>150ms - ì¶”ì²œ</option>
                  <option value="300">300ms - ì—¬ìœ ë¡­ê²Œ</option>
                  <option value="500">500ms - ì¶©ë¶„íˆ</option>
                </select>
                <div class="small" style="margin-top:4px;color:var(--muted)">ë§í•˜ëŠ” ì‚¬ëŒì´ ë°”ë€ŒëŠ” ì§€ì ì—ë§Œ ì§§ê²Œ ì‰¬ì–´ ë” ìì—°ìŠ¤ëŸ½ê²Œ ë“¤ë¦½ë‹ˆë‹¤.</div>
              </div>

              <div class="setting-group">
                <label>ì¤„ë§ˆë‹¤ ê¸°ë³¸ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°</label>
                <button id="lineResetTgl" class="btn btn-primary" aria-pressed="true">ON</button>
                <div class="small" style="margin-top:4px;color:var(--muted)">ONì´ë©´ <b>ê·¸ ì¤„ì— ì íŒ ì´ë¦„ë§Œ</b> í•´ë‹¹ ëª©ì†Œë¦¬ë¡œ ì½ê³ , ë‹¤ìŒ ì¤„ì€ ìë™ìœ¼ë¡œ <b>ê¸°ë³¸ ëª©ì†Œë¦¬</b>ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</div>
              </div>
            </div>

            <!-- ì—­í•  ê´€ë¦¬ ë„êµ¬ -->
            <div style="margin-top:16px">
              <div class="controls" style="justify-content:space-between;margin-bottom:8px">
                <h3 style="margin:0">ì´ë¦„ ì„¤ì •í‘œ</h3>
                <div class="controls">
                  <button id="detectBtn" class="btn btn-secondary small">ì´ë¦„ ìë™ì°¾ê¸°</button>
                  <button id="addRoleBtn" class="btn btn-secondary small">ì´ë¦„ ì¶”ê°€</button>
                  <button id="seniorAllBtn" class="btn btn-secondary small">ëª¨ë‘ ë“£ê¸° í¸í•˜ê²Œ</button>
                  <button id="resetRolesBtn" class="btn btn-danger small">ì´ˆê¸°í™”</button>
                </div>
              </div>

              <!-- ì—­í•  í…Œì´ë¸” -->
              <div class="role-table-container">
                <div class="list">
                  <table class="small role-table" id="roleTable">
                    <thead>
                      <tr>
                        <th>ì´ë¦„</th>
                        <th>ëª©ì†Œë¦¬</th>
                        <th>â–¶</th>
                        <th>ì†ë„(%)</th>
                        <th>í†¤(semi)</th>
                        <th>ë³¼ë¥¨(dB)</th>
                        <th>ë“£ê¸° í¸í•¨</th>
                        <th>ì–¸ì–´</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="small" id="roleCount" style="margin-top:6px;color:var(--muted)"></div>

              <!-- ì„ íƒ ë„êµ¬ -->
              <div class="controls small" style="margin-top:8px">
                <button id="aliasBtn" class="btn btn-secondary">ì„ íƒí•œ ë¬¸ì¥ì— ì´ë¦„ ë¶™ì´ê¸°</button>
                <button id="altBtn" class="btn btn-secondary">ì—¬ëŸ¬ ì¤„ì— A/B ë²ˆê°ˆì•„ ë¶™ì´ê¸°</button>
              </div>
            </div>
          </div>

          <!-- SSML ì¹˜íŠ¸ì‹œíŠ¸ -->
          <div id="ssmlCheat" class="panel" style="display:none">
            <h3>SSML ëª…ë ¹(ì „ì²´)</h3>
            <ul class="small">
              <li><code class="mono">&lt;speak&gt;...&lt;/speak&gt;</code> â€” ë£¨íŠ¸ ì»¨í…Œì´ë„ˆ (í•„ìˆ˜)</li>
              <li><code class="mono">&lt;p&gt;</code>, <code class="mono">&lt;s&gt;</code> â€” ë¬¸ë‹¨/ë¬¸ì¥ ê²½ê³„</li>
              <li><code class="mono">&lt;break time="300ms"/&gt;</code> â€” ì‰¬ê¸° (ì˜ˆ: 150ms, 300ms)</li>
              <li><code class="mono">&lt;emphasis level="moderate|strong|reduced"&gt;ê°•ì¡°&lt;/emphasis&gt;</code></li>
              <li><code class="mono">&lt;prosody rate="0.95" pitch="-2st" volume="+2dB"&gt;í…ìŠ¤íŠ¸&lt;/prosody&gt;</code></li>
              <li><code class="mono">&lt;say-as interpret-as="characters|digits|cardinal|ordinal|date|time|telephone"&gt;ê°’&lt;/say-as&gt;</code></li>
              <li><code class="mono">&lt;sub alias="ëŒ€ì²´ ë°œìŒ"&gt;ì›ë¬¸&lt;/sub&gt;</code> â€” ë°œìŒ ë°”ê¾¸ê¸°</li>
              <li><code class="mono">&lt;mark name="S1"/&gt;</code> â€” íƒ€ì„í¬ì¸íŠ¸(ë§ˆì»¤)</li>
            </ul>
          </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜: ìŒì„± ì„¤ì • ë° ì‹¤í–‰ -->
        <div class="right-section">
          <!-- ê¸°ë³¸ ìŒì„± ì„¤ì • -->
          <div class="panel">
            <h2>ê¸°ë³¸ ìŒì„± ì„¤ì •</h2>
            <div class="setting-group">
              <label>ì–¸ì–´</label>
              <select id="baseLangSel"></select>
            </div>
            <div class="setting-group">
              <label>ëª©ì†Œë¦¬</label>
              <select id="baseVoiceSel"></select>
              <button id="basePreviewBtn" class="btn btn-secondary small" style="margin-top:6px">â–¶ ë¯¸ë¦¬ë“£ê¸°</button>
            </div>
            <div id="baseVoiceInfo" class="voice-info"></div>
          </div>

          <!-- ì¼ë°˜ ëª¨ë“œ ìŒì„± ì¡°ì ˆ -->
          <div class="panel" id="plainVoiceControls" style="display:none">
            <h2>ìŒì„± ì¡°ì ˆ</h2>
            
            <div class="setting-group">
              <label>ë§í•˜ê¸° ì†ë„</label>
              <div class="slider-container">
                <input type="range" id="plainSpeedSlider" class="slider" min="25" max="400" value="100" step="5">
                <span class="slider-value" id="plainSpeedValue">100%</span>
              </div>
              <div class="controls" style="margin-top:4px">
                <button class="btn btn-secondary small" onclick="setPlainSpeed(75)">ëŠë¦¬ê²Œ</button>
                <button class="btn btn-secondary small" onclick="setPlainSpeed(100)">ë³´í†µ</button>
                <button class="btn btn-secondary small" onclick="setPlainSpeed(150)">ë¹ ë¥´ê²Œ</button>
              </div>
            </div>

            <div class="setting-group">
              <label>ìŒë†’ì´ (ë°˜ìŒ)</label>
              <div class="slider-container">
                <input type="range" id="plainPitchSlider" class="slider" min="-20" max="20" value="0" step="1">
                <span class="slider-value" id="plainPitchValue">0</span>
              </div>
              <div class="controls" style="margin-top:4px">
                <button class="btn btn-secondary small" onclick="setPlainPitch(-5)">ë‚®ê²Œ</button>
                <button class="btn btn-secondary small" onclick="setPlainPitch(0)">ë³´í†µ</button>
                <button class="btn btn-secondary small" onclick="setPlainPitch(5)">ë†’ê²Œ</button>
              </div>
            </div>

            <div class="setting-group">
              <label>ë³¼ë¥¨ (dB)</label>
              <div class="slider-container">
                <input type="range" id="plainVolumeSlider" class="slider" min="-10" max="16" value="0" step="0.5">
                <span class="slider-value" id="plainVolumeValue">0dB</span>
              </div>
              <div class="controls" style="margin-top:4px">
                <button class="btn btn-secondary small" onclick="setPlainVolume(-6)">ì‘ê²Œ</button>
                <button class="btn btn-secondary small" onclick="setPlainVolume(0)">ë³´í†µ</button>
                <button class="btn btn-secondary small" onclick="setPlainVolume(6)">í¬ê²Œ</button>
              </div>
            </div>
          </div>

          <!-- ì˜¤ë””ì˜¤ íš¨ê³¼ í”„ë¡œí•„ -->
          <div class="panel">
            <h2>ì˜¤ë””ì˜¤ íš¨ê³¼</h2>
            <div class="setting-group">
              <label>ì¬ìƒ í™˜ê²½ ìµœì í™”</label>
              <select id="effectsProfileSel">
                <option value="">ì—†ìŒ (ê¸°ë³¸)</option>
                <option value="headphone-class-device">í—¤ë“œí°ìš©</option>
                <option value="handset-class-device">íœ´ëŒ€í° ìŠ¤í”¼ì»¤ìš©</option>
                <option value="small-bluetooth-speaker-class-device">ë¸”ë£¨íˆ¬ìŠ¤ ìŠ¤í”¼ì»¤ (ì†Œí˜•)</option>
                <option value="medium-bluetooth-speaker-class-device">ë¸”ë£¨íˆ¬ìŠ¤ ìŠ¤í”¼ì»¤ (ì¤‘í˜•)</option>
                <option value="large-home-entertainment-class-device">í™ˆ ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œìš©</option>
                <option value="large-automotive-class-device">ìë™ì°¨ìš©</option>
                <option value="telephony-class-application">ì „í™”í†µí™”ìš©</option>
                <option value="wearable-class-device">ì›¨ì–´ëŸ¬ë¸” ê¸°ê¸°ìš©</option>
              </select>
              <div class="small" style="margin-top:6px;color:var(--muted)">ì„ íƒí•œ ì¬ìƒ í™˜ê²½ì— ë§ê²Œ ìŒì§ˆì„ ìµœì í™”í•©ë‹ˆë‹¤.</div>
            </div>
          </div>

          <!-- ì¶œë ¥ ì„¤ì • -->
          <div class="panel">
            <h2>ì¶œë ¥ ì„¤ì •</h2>
            
            <div class="setting-group">
              <label>ì˜¤ë””ì˜¤ í˜•ì‹</label>
              <select id="encodingSelect">
                <option value="MP3">MP3 (ì¼ë°˜ìš©, ì‘ì€ íŒŒì¼)</option>
                <option value="LINEAR16">WAV (ê³ í’ˆì§ˆ, í° íŒŒì¼)</option>
                <option value="OGG_OPUS">OGG (ì••ì¶• íš¨ìœ¨ì )</option>
              </select>
            </div>

            <div class="setting-group">
              <label>ìƒ˜í”Œë ˆì´íŠ¸</label>
              <select id="sampleRateSelect">
                <option value="24000">24kHz (ê¸°ë³¸)</option>
                <option value="44100">44.1kHz (CD í’ˆì§ˆ)</option>
                <option value="48000">48kHz (ê³ í’ˆì§ˆ)</option>
              </select>
            </div>

            <div class="setting-group">
              <label>ë¬¸ì¥ ì‚¬ì´ ì‰¬ê¸°</label>
              <select id="sentenceBreakSelect">
                <option value="0">0ms - ì—°ì†ìœ¼ë¡œ</option>
                <option value="150">150ms - ìì—°ìŠ¤ëŸ½ê²Œ</option>
                <option value="300">300ms - ë˜ë°•ë˜ë°•</option>
                <option value="500">500ms - ì²œì²œíˆ</option>
                <option value="1000">1000ms - ì—¬ìœ ë¡­ê²Œ</option>
              </select>
            </div>

            <div class="setting-group">
              <label>ê¸°íƒ€ ì„¤ì •</label>
              <div class="controls" style="flex-direction:column;align-items:stretch;gap:6px">
                <div class="controls">
                  <label style="min-width:120px">ì „ì²´ ìŒì„± í¬ê¸° ê· ë“±í™”</label>
                  <button id="normTgl" class="btn btn-primary" aria-pressed="true">ON</button>
                </div>
                <div class="controls">
                  <label style="min-width:120px">ì¬ì‹œë„ íšŸìˆ˜</label>
                  <select id="retrySelect" style="width:100px">
                    <option value="0">0íšŒ</option>
                    <option value="1">1íšŒ</option>
                    <option value="3" selected>3íšŒ</option>
                    <option value="5">5íšŒ</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- ìŒì„± ë§Œë“¤ê¸° -->
          <div class="panel">
            <h2>ìŒì„± ìƒì„±</h2>
            <div class="controls" style="flex-direction:column;gap:8px">
              <button id="makeBtn" class="btn btn-primary" style="width:100%"><span id="makeLabel">ìŒì„± ë§Œë“¤ê¸°</span></button>
              <button id="cancelBtn" class="btn btn-danger" style="display:none;width:100%">ì·¨ì†Œ</button>
              <span id="status" class="small"></span>
            </div>
            
            <!-- ì§„í–‰ ìƒíƒœ ë°” -->
            <div class="progress-bar" id="progressBar" style="display:none">
              <div class="progress-fill" id="progressFill" style="width:0%"></div>
            </div>
            
            <!-- ì—ëŸ¬ ë©”ì‹œì§€ ì˜ì—­ -->
            <div id="errorArea"></div>
            
            <audio id="player" controls style="margin-top:8px;width:100%"></audio>
            <div class="controls small" style="margin-top:6px;flex-direction:column;gap:6px">
              <a id="download" class="btn btn-secondary small" href="#" style="display:none;width:100%">ë‹¤ìš´ë¡œë“œ</a>
              <span class="small" id="outInfo" style="text-align:center"></span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ì–¸ì–´ ìƒ˜í”Œ & API ì„¤ì • -->
    <section class="section">
      <div class="row">
        <!-- ì–¸ì–´ ìƒ˜í”Œ -->
        <div class="panel">
          <h2>ì–¸ì–´ ìƒ˜í”Œ</h2>
          <div class="setting-group">
            <label>ì–¸ì–´ ì„ íƒ</label>
            <select id="sampleLang"></select>
          </div>
          <div class="setting-group">
            <label>ìƒ˜í”Œ ë¬¸ì¥</label>
            <input id="sampleText" type="text" class="mono" value="ì•ˆë…•í•˜ì„¸ìš”. ì´ê²ƒì€ ìƒ˜í”Œ ë¬¸ì¥ì…ë‹ˆë‹¤." />
          </div>
          <div class="small" style="margin:8px 0;color:var(--muted)">ì–¸ì–´ë¥¼ ê³ ë¥´ë©´ ì•„ë˜ì— ê·¸ ì–¸ì–´ì˜ ëª©ì†Œë¦¬ë“¤ì´ ì­‰ ë‚˜ì˜µë‹ˆë‹¤. ê° í–‰ì˜ â–¶ë¡œ ë“¤ì–´ë³´ê³ , ë²„íŠ¼ìœ¼ë¡œ ì´ë¦„ ì„¤ì •í‘œì— ë°”ë¡œ ì§€ì •í•  ìˆ˜ ìˆì–´ìš”.</div>
          <div class="list">
            <table class="small" id="voiceTable">
              <thead><tr><th>ì´ë¦„</th><th>ì •ë³´</th><th>â–¶</th><th>ê¸°ë³¸ ì´ë¦„ì— ì“°ê¸°</th><th>ì„ íƒ ì´ë¦„ì— ì“°ê¸°</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- API ì„¤ì • -->
        <div class="panel">
          <h2>API ì„¤ì •</h2>
          <div class="setting-group">
            <label for="apiKey">Google TTS API í‚¤</label>
            <div class="controls" style="flex-direction:column;gap:6px">
              <input id="apiKey" type="password" placeholder="AIza... (ë‹¹ì‹ ì˜ í‚¤)" autocomplete="off" />
              <div class="controls">
                <button id="showKeyBtn" class="btn btn-secondary">í‘œì‹œ</button>
                <button id="saveKeyBtn" class="btn btn-primary">ì €ì¥</button>
                <button id="clearKeyBtn" class="btn btn-danger">ì‚­ì œ</button>
                <button id="testBtn" class="btn btn-secondary">í…ŒìŠ¤íŠ¸</button>
              </div>
            </div>
          </div>
          <p class="small" style="margin-top:6px;color:var(--muted)">í‚¤ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. GCP ì½˜ì†”ì—ì„œ Text-to-Speech API í™œì„±í™” â†’ API ì œí•œì—ì„œ TTSë§Œ í—ˆìš© â†’ ë‚´ ë„ë©”ì¸ì„ HTTP referrerë¡œ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
        </div>
      </div>
    </section>

    <!-- ì„¤ëª…ì„œ -->
    <section class="section">
      <div class="panel">
        <h2>ì„¤ëª…ì„œ</h2>
        <div class="small" style="line-height:1.7">
          <h3>ëª¨ë“œ</h3>
          <ul>
            <li><b>ì¼ë°˜</b>: í•œ ì‚¬ëŒì´ ì­‰ ì½ìŠµë‹ˆë‹¤. ìŒì„± ì¡°ì ˆê³¼ ì˜¤ë””ì˜¤ íš¨ê³¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            <li><b>ì—­í•  ëŒ€í™”</b>: ì¤„ ì•ì— <code class="mono">ì´ë¦„: ë‚´ìš©</code> ë˜ëŠ” <code class="mono">[ì´ë¦„] ë‚´ìš©</code> í˜•íƒœë¡œ ì“°ë©´, ì´ë¦„ë³„ ëª©ì†Œë¦¬ë¥¼ ì ìš©í•©ë‹ˆë‹¤.</li>
            <li><b>ì„¸ë°€ ì¡°ì ˆ(ì „ë¬¸ê°€ìš©)</b>: SSMLì„ ì§ì ‘ ì”ë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ ì°¸ì¡°.</li>
          </ul>

          <h3>ìƒˆë¡œìš´ ê¸°ëŠ¥</h3>
          <ul>
            <li><b>ê°œì„ ëœ UI</b>: í…ìŠ¤íŠ¸ ì…ë ¥ì„ ì™¼ìª½ì— ë„“ê²Œ, ì„¤ì •ì„ ì˜¤ë¥¸ìª½ì— ê¹”ë”í•˜ê²Œ ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤.</li>
            <li><b>ì •í™•í•œ ëª©ì†Œë¦¬ ì •ë³´</b>: ì„±ë³„, ëª¨ë¸ ìœ í˜•, í’ˆì§ˆ ë“±ê¸‰ì„ ì •í™•í•˜ê²Œ í‘œì‹œí•©ë‹ˆë‹¤.</li>
            <li><b>ë“œë¡­ë‹¤ìš´ ì„¤ì •</b>: ëª¨ë“  ì¶œë ¥ ì„¤ì •ì„ ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.</li>
            <li><b>ìŒì„± ì¡°ì ˆ</b>: ì¼ë°˜ ëª¨ë“œì—ì„œ ì†ë„, ìŒë†’ì´, ë³¼ë¥¨ì„ ì„¸ë°€í•˜ê²Œ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            <li><b>ì˜¤ë””ì˜¤ íš¨ê³¼</b>: í—¤ë“œí°, ìŠ¤í”¼ì»¤, ìë™ì°¨ ë“± ì¬ìƒ í™˜ê²½ì— ë§ê²Œ ìŒì§ˆì„ ìµœì í™”í•©ë‹ˆë‹¤.</li>
          </ul>

          <h3>ê¸´ ê¸€ ìë™ ë‚˜ëˆ”</h3>
          <p>Google TTSëŠ” <b>ìš”ì²­ë‹¹ 5,000ë°”ì´íŠ¸</b> ì œí•œì´ ìˆìŠµë‹ˆë‹¤. <b>í•œê¸€ë§Œ ê¸°ì¤€ ì•½ 1,600ì</b>ë¥¼ ë„˜ê¸°ë©´ ì˜¤ë¥˜/ëŠê¹€ì´ ìƒê¸¸ ìˆ˜ ìˆì–´ <b>ìë™ ë‚˜ëˆ” ON</b>ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
        </div>
      </div>
    </section>

    <!-- í•˜ë‹¨ ê´‘ê³  & í‘¸í„° -->
    <div class="ad-space"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3006330103681332" data-ad-slot="3909128617" data-ad-format="auto" data-full-width-responsive="true"></ins></div>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>

    <footer class="site">
      <div class="container footer-row">
        <div class="footer-links">
          <a href="/text/">í…ìŠ¤íŠ¸ ì •ë¦¬</a>
          <a href="/utility/">ì—…ë¬´ ìœ í‹¸</a>
          <a href="/audio/">ì˜¤ë””ì˜¤</a>
          <a href="/privacy/">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>
        </div>
        <div class="small">Â© 2025 Thenaom</div>
      </div>
    </footer>
  </main>

  <!-- ====== ìŠ¤í¬ë¦½íŠ¸ ====== -->
  <script>
    // Theme toggle (ê³µí†µ)
    (function(){
      const btn=document.getElementById('themeToggle'); 
      if(!btn) return;
      function sync(){ 
        const mode=document.documentElement.getAttribute('data-theme')||'light'; 
        btn.setAttribute('aria-pressed', mode==='dark'); 
        btn.querySelector('.icon').textContent = mode==='dark'?'ğŸŒ™':'ğŸŒ'; 
        btn.querySelector('.label').textContent = mode==='dark'?'ë‹¤í¬':'ë¼ì´íŠ¸'; 
      }
      btn.addEventListener('click', function(){ 
        const cur=document.documentElement.getAttribute('data-theme')||'light'; 
        const next=(cur==='dark'?'light':'dark'); 
        document.documentElement.setAttribute('data-theme', next); 
        localStorage.setItem('theme', next); 
        sync();
      });
      sync();
    })();

    // ===== ìƒíƒœ/ì €ì¥ í‚¤ =====
    const LS = {
      KEY: 'gcpKey', 
      ROLES: 'rolesV8', 
      MODE: 'modeV8', 
      OPTS: 'optsV8', 
      SAMPLE: 'sampleLangV8'
    };
    
    const $ = id => document.getElementById(id);
    const bCount = s => new TextEncoder().encode(s||'').length;
    const on = (el, ev, fn) => el && el.addEventListener(ev, fn);
    const sleep = ms => new Promise(r => setTimeout(r, ms));
    
    // ì „ì—­ ë³€ìˆ˜ë“¤
    let cancelRequested = false;
    let activeAudioUrls = [];

    // ë¯¸ë‹ˆ API ë°°ì§€
    function updateApiBadge(){
      const has = !!localStorage.getItem(LS.KEY);
      const badge = $('apiBadge'); 
      const txt = $('apiMiniText');
      badge.classList.toggle('btn-primary', has);
      badge.classList.toggle('btn-danger', !has);
      badge.textContent = has ? 'API ì €ì¥ë¨' : 'API ì…ë ¥ í•„ìš”';
      txt.textContent = has ? 'ì´ ë¸Œë¼ìš°ì €ì— API í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤' : 'API í‚¤ë¥¼ ì €ì¥í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”';
    }

    // ì¹´ìš´í„°
    const editor = $('editor');
    function updateCounter(){ 
      $('counter').textContent = editor.value.length + " ê¸€ì / " + bCount(editor.value) + " ë°”ì´íŠ¸"; 
    }
    on(editor, 'input', updateCounter);

    // ëª¨ë“œ ì„¤ì •
    let mode = localStorage.getItem(LS.MODE) || 'dialog';
    function setMode(m){ 
      mode = m; 
      localStorage.setItem(LS.MODE, m); 
      $('modeMini').textContent = (m === 'plain' ? 'ì¼ë°˜' : (m === 'dialog' ? 'ì—­í•  ëŒ€í™”' : 'ì„¸ë°€ ì¡°ì ˆ'));
      
      // ëª¨ë“œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
      document.querySelectorAll('#modeChips .btn').forEach(b => { 
        const on = (b.dataset.val === m); 
        b.classList.toggle('btn-primary', on); 
        b.classList.toggle('btn-secondary', !on); 
        b.setAttribute('aria-pressed', on); 
      });
      
      // íŒíŠ¸ í…ìŠ¤íŠ¸ ë³€ê²½
      if (m === 'plain') {
        $('modeHint').textContent = 'ì¼ë°˜: í•œ ì‚¬ëŒì´ ì­‰ ì½ìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì—ì„œ ìŒì„±ì„ ì„¸ë°€í•˜ê²Œ ì¡°ì ˆí•  ìˆ˜ ìˆì–´ìš”.';
        editor.placeholder = 'ì˜ˆ: ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì.';
      } else if (m === 'dialog') {
        $('modeHint').textContent = 'ì—­í•  ëŒ€í™”: ì¤„ ì•ì— "ì´ë¦„: ë‚´ìš©" ë˜ëŠ” "[ì´ë¦„] ë‚´ìš©"';
        editor.placeholder = 'ì˜ˆ: í• ë¨¸ë‹ˆ: ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì.\nì†Œë…„: ì•„ì§ í•  ë§ì´ ìˆì–´ìš”!';
      } else {
        $('modeHint').textContent = 'ì„¸ë°€ ì¡°ì ˆ: <speak>â€¦</speak> ì— SSML ëª…ë ¹ ì‚¬ìš©';
        editor.placeholder = '<speak>ì•ˆë…•í•˜ì„¸ìš”. <break time="300ms"/> ì•ˆë‚´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</speak>';
      }
      
      // íŒ¨ë„ í‘œì‹œ/ìˆ¨ê¹€
      const dialogOptions = $('dialogOptions');
      const ssmlCheat = $('ssmlCheat');
      const plainVoiceControls = $('plainVoiceControls');
      
      if (dialogOptions) {
        dialogOptions.style.display = (m === 'dialog') ? 'block' : 'none';
      }
      if (ssmlCheat) {
        ssmlCheat.style.display = (m === 'ssml') ? 'block' : 'none';
      }
      if (plainVoiceControls) {
        plainVoiceControls.style.display = (m === 'plain') ? 'block' : 'none';
      }
    }

    // ëª¨ë“œ ì¹© ì´ë²¤íŠ¸
    document.querySelectorAll('#modeChips .btn').forEach(b => 
      on(b, 'click', () => setMode(b.dataset.val))
    );

    // ì¼ë°˜ ëª¨ë“œ ìŒì„± ì¡°ì ˆ í•¨ìˆ˜ë“¤
    function setPlainSpeed(value) {
      $('plainSpeedSlider').value = value;
      $('plainSpeedValue').textContent = value + '%';
      autosave();
    }

    function setPlainPitch(value) {
      $('plainPitchSlider').value = value;
      $('plainPitchValue').textContent = value;
      autosave();
    }

    function setPlainVolume(value) {
      $('plainVolumeSlider').value = value;
      $('plainVolumeValue').textContent = value + 'dB';
      autosave();
    }

    // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
    on($('plainSpeedSlider'), 'input', (e) => {
      $('plainSpeedValue').textContent = e.target.value + '%';
      autosave();
    });

    on($('plainPitchSlider'), 'input', (e) => {
      $('plainPitchValue').textContent = e.target.value;
      autosave();
    });

    on($('plainVolumeSlider'), 'input', (e) => {
      $('plainVolumeValue').textContent = e.target.value + 'dB';
      autosave();
    });

    // ìë™ ì €ì¥ ì˜µì…˜
    function loadOpts(){ 
      try { 
        return JSON.parse(localStorage.getItem(LS.OPTS) || '{}'); 
      } catch { 
        return {}; 
      } 
    }
    
    function autosave(){ 
      const data = {
        encoding: $('encodingSelect') ? $('encodingSelect').value : 'MP3',
        sampleRate: $('sampleRateSelect') ? $('sampleRateSelect').value : '44100',
        sentenceBreak: $('sentenceBreakSelect') ? $('sentenceBreakSelect').value : '300',
        switchDelay: $('switchSelect') ? $('switchSelect').value : '150',
        norm: $('normTgl') ? $('normTgl').getAttribute('aria-pressed') === 'true' : true,
        chunk: $('chunkTgl') ? $('chunkTgl').getAttribute('aria-pressed') === 'true' : true,
        retry: $('retrySelect') ? $('retrySelect').value : '3',
        lineReset: $('lineResetTgl') ? $('lineResetTgl').getAttribute('aria-pressed') === 'true' : true,
        plainSpeed: $('plainSpeedSlider') ? $('plainSpeedSlider').value : '100',
        plainPitch: $('plainPitchSlider') ? $('plainPitchSlider').value : '0',
        plainVolume: $('plainVolumeSlider') ? $('plainVolumeSlider').value : '0',
        effectsProfile: $('effectsProfileSel') ? $('effectsProfileSel').value : ''
      }; 
      localStorage.setItem(LS.OPTS, JSON.stringify(data)); 
    }

    // í† ê¸€ ê³µí†µ
    function toggleBtn(btn){ 
      const on = btn.getAttribute('aria-pressed') === 'true'; 
      btn.setAttribute('aria-pressed', String(!on)); 
      btn.classList.toggle('btn-primary', !on); 
      btn.classList.toggle('btn-secondary', on); 
      btn.textContent = (!on) ? 'ON' : 'OFF'; 
      autosave(); 
    }

    // ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ë“¤
    ['encodingSelect', 'sampleRateSelect', 'sentenceBreakSelect', 'switchSelect', 'retrySelect', 'effectsProfileSel'].forEach(id => {
      const el = $(id);
      if (el) on(el, 'change', autosave);
    });
    
    on($('normTgl'), 'click', e => toggleBtn(e.currentTarget));
    on($('chunkTgl'), 'click', e => toggleBtn(e.currentTarget));
    on($('lineResetTgl'), 'click', e => toggleBtn(e.currentTarget));

    // API í‚¤
    const apiKey = $('apiKey');
    on($('showKeyBtn'), 'click', () => { 
      apiKey.type = (apiKey.type === 'password' ? 'text' : 'password'); 
      $('showKeyBtn').textContent = (apiKey.type === 'password' ? 'í‘œì‹œ' : 'ìˆ¨ê¸°ê¸°'); 
    });
    
    on($('saveKeyBtn'), 'click', () => { 
      const v = apiKey.value.trim(); 
      if (!v) return showError('API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); 
      localStorage.setItem(LS.KEY, v); 
      updateApiBadge(); 
      showSuccess('API í‚¤ ì €ì¥ë¨'); 
      loadVoices().then(() => {
        renderVoiceList(); 
        renderBaseVoiceSelect();
      }); 
    });
    
    on($('clearKeyBtn'), 'click', () => { 
      localStorage.removeItem(LS.KEY); 
      updateApiBadge(); 
      showWarning('API í‚¤ ì‚­ì œë¨'); 
    });
    
    on($('testBtn'), 'click', async () => { 
      try { 
        if (!localStorage.getItem(LS.KEY)) throw new Error('API í‚¤ê°€ ì—†ìŒ'); 
        await loadVoices(); 
        showSuccess('ì •ìƒ: ëª©ì†Œë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤'); 
        renderVoiceList(); 
        renderBaseVoiceSelect();
      } catch (e) { 
        showError('ì‹¤íŒ¨: ' + parseError(e)); 
      } 
    });

    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ë“¤
    function showError(msg) {
      const area = $('errorArea');
      if (area) {
        area.innerHTML = `<div class="error-msg">${msg}</div>`;
        setTimeout(() => area.innerHTML = '', 5000);
      } else {
        alert(msg);
      }
    }

    function showWarning(msg) {
      const area = $('errorArea');
      if (area) {
        area.innerHTML = `<div class="warning-msg">${msg}</div>`;
        setTimeout(() => area.innerHTML = '', 5000);
      } else {
        alert(msg);
      }
    }

    function showSuccess(msg) {
      alert(msg);
    }

    // ì—ëŸ¬ íŒŒì‹±
    function parseError(e) {
      if (e.message) {
        if (e.message.includes('403')) return 'ê¶Œí•œ ì˜¤ë¥˜: API í‚¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜ API ì œí•œ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”';
        if (e.message.includes('400')) return 'ì˜ëª»ëœ ìš”ì²­: í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¸¸ê±°ë‚˜ í˜•ì‹ì´ ì˜ëª»ë¨';
        if (e.message.includes('429')) return 'ìš”ì²­ í•œë„ ì´ˆê³¼: ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”';
        if (e.message.includes('500')) return 'Google ì„œë²„ ì˜¤ë¥˜: ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”';
        if (e.message.includes('does not support SSML')) return 'ì´ ìŒì„±ì€ SSMLì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
        return e.message;
      }
      return String(e);
    }

    // ê°œì„ ëœ ëª©ì†Œë¦¬ ë¶„ì„ í•¨ìˆ˜
    function analyzeVoice(voice) {
      const name = voice.name.toLowerCase();
      
      // ì‹¤ì œ API ë°ì´í„° ì‚¬ìš©
      let gender = 'neutral';
      if (voice.ssmlGender === 'FEMALE') gender = 'female';
      else if (voice.ssmlGender === 'MALE') gender = 'male';
      else if (voice.ssmlGender === 'NEUTRAL') gender = 'neutral';
      
      // ëª¨ë¸ ìœ í˜• ë° í’ˆì§ˆ ë¶„ì„
      let modelType = 'Standard';
      let quality = 'standard';
      let isLatest = false;
      
      if (name.includes('neural2')) {
        modelType = 'Neural2';
        quality = 'premium';
        isLatest = true;
      } else if (name.includes('wavenet')) {
        modelType = 'WaveNet';
        quality = 'premium';
      } else if (name.includes('chirp3') || name.includes('chirp-hd')) {
        modelType = 'Chirp HD';
        quality = 'premium';
        isLatest = true;
      } else if (name.includes('studio')) {
        modelType = 'Studio';
        quality = 'premium';
        isLatest = true;
      } else if (name.includes('standard')) {
        modelType = 'Standard';
        quality = 'standard';
      }
      
      return { gender, modelType, quality, isLatest };
    }

    // ëª©ì†Œë¦¬ ì •ë³´ í‘œì‹œ
    function formatVoiceInfo(voice) {
      const info = analyzeVoice(voice);
      const genderText = info.gender === 'female' ? 'ì—¬ì„±' : (info.gender === 'male' ? 'ë‚¨ì„±' : 'ì¤‘ì„±');
      
      let tags = `<span class="voice-tag ${info.gender}">${genderText}</span>`;
      tags += `<span class="voice-tag ${info.quality}">${info.modelType}</span>`;
      if (info.isLatest) {
        tags += `<span class="voice-tag latest">ìµœì‹ </span>`;
      }
      
      return tags;
    }

    // ë“œë¡­ë‹¤ìš´ìš© ëª©ì†Œë¦¬ ì˜µì…˜ í…ìŠ¤íŠ¸
    function formatVoiceOption(voice) {
      const info = analyzeVoice(voice);
      const genderText = info.gender === 'female' ? 'ì—¬ì„±' : (info.gender === 'male' ? 'ë‚¨ì„±' : 'ì¤‘ì„±');
      const latestText = info.isLatest ? ', ìµœì‹ ' : '';
      return `${voice.name} (${genderText}, ${info.modelType}${latestText})`;
    }

    // ëª©ì†Œë¦¬ ëª©ë¡
    let VOICES = []; 
    let voiceIndex = {};
    
    async function loadVoices(){ 
      const key = localStorage.getItem(LS.KEY); 
      if (!key) return; 
      const u = new URL('https://texttospeech.googleapis.com/v1/voices'); 
      u.searchParams.set('key', key); 
      const r = await fetch(u); 
      const j = await r.json(); 
      if (!r.ok) throw new Error(j.error?.message || r.statusText); 
      VOICES = (j.voices || []).sort((a, b) => a.name > b.name ? 1 : -1); 
      voiceIndex = {}; 
      VOICES.forEach(v => voiceIndex[v.name] = v); 
    }

    // ì´ë¦„(ì—­í• ) ê´€ë¦¬
    const roleBody = document.querySelector('#roleTable tbody');
    let roles = JSON.parse(localStorage.getItem(LS.ROLES) || '{}');
    
    function ensureBaseRole(){ 
      if (!roles._) { 
        roles._ = {voice: '', speed: '100', pitch: '0', vol: '0', lang: 'ko-KR', comfy: true}; 
      } 
    }
    
    function saveRoles(){ 
      localStorage.setItem(LS.ROLES, JSON.stringify(roles)); 
    }
    
    function roleRow(alias, data){ 
      const tr = document.createElement('tr');
      const langs = [...new Set(VOICES.flatMap(v => v.languageCodes || []))].sort();
      const langOpts = langs.map(c => `<option ${data.lang === c ? 'selected' : ''} value="${c}">${c}</option>`).join('');
      const voicesForLang = VOICES.filter(v => (v.languageCodes || []).includes(data.lang));
      const vOptions = `<option value="" ${!data.voice ? 'selected' : ''}>â€” ì„ íƒ â€”</option>` + 
        (voicesForLang.length ? voicesForLang : VOICES).map(v => 
          `<option ${data.voice === v.name ? 'selected' : ''} value="${v.name}">${formatVoiceOption(v)}</option>`
        ).join('');
      
      tr.innerHTML = `
        <td class="mono">${alias === '_' ? 'ê¸°ë³¸' : alias}${!data.voice ? '<span style="background:#ef4444;color:#fff;border-radius:6px;padding:1px 6px;margin-left:6px;font-size:11px">ëª©ì†Œë¦¬ ì„ íƒ</span>' : ''}</td>
        <td><select class="voiceSel">${vOptions}</select></td>
        <td><button class="btn btn-secondary small prevBtn">â–¶</button></td>
        <td>
          <div class="controls">
            <input class="speedNum" type="number" min="50" max="200" step="1" value="${data.speed}" style="width:90px" />
            <div class="controls">
              <button class="btn btn-secondary small speedC" data-val="80">ëŠë¦¬ê²Œ</button>
              <button class="btn btn-secondary small speedC" data-val="100">ë³´í†µ</button>
              <button class="btn btn-secondary small speedC" data-val="120">ë¹ ë¥´ê²Œ</button>
            </div>
          </div>
        </td>
        <td>
          <div class="controls">
            <input class="pitchNum" type="number" min="-12" max="12" step="1" value="${data.pitch}" style="width:90px" />
            <div class="controls">
              <button class="btn btn-secondary small pitchC" data-val="-2">ë‚®ê²Œ</button>
              <button class="btn btn-secondary small pitchC" data-val="0">ë³´í†µ</button>
              <button class="btn btn-secondary small pitchC" data-val="+2">ë†’ê²Œ</button>
            </div>
          </div>
        </td>
        <td>
          <div class="controls">
            <input class="volNum" type="number" min="-10" max="10" step="0.1" value="${data.vol}" style="width:90px" />
            <div class="controls">
              <button class="btn btn-secondary small volC" data-val="-2">ì‘ê²Œ</button>
              <button class="btn btn-secondary small volC" data-val="0">ë³´í†µ</button>
              <button class="btn btn-secondary small volC" data-val="+2">í¬ê²Œ</button>
            </div>
          </div>
        </td>
        <td><button class="btn ${data.comfy ? 'btn-primary' : 'btn-secondary'} small comfy" aria-pressed="${data.comfy ? 'true' : 'false'}">${data.comfy ? 'ON' : 'OFF'}</button></td>
        <td><select class="langSel">${langOpts}</select></td>`;
      
      // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      tr.querySelector('.prevBtn').onclick = () => { 
        const name = tr.querySelector('.voiceSel').value; 
        if (!name) return showError('ë¨¼ì € ëª©ì†Œë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”'); 
        previewVoice(name, tr.querySelector('.langSel').value); 
      };
      
      tr.querySelector('.voiceSel').onchange = (e) => { 
        data.voice = e.target.value; 
        saveRoles(); 
        renderRoles(); 
      };
      
      tr.querySelector('.langSel').onchange = (e) => { 
        data.lang = e.target.value; 
        saveRoles(); 
        renderRoles(); 
      };
      
      tr.querySelectorAll('.speedC').forEach(b => 
        b.onclick = () => { 
          data.speed = b.dataset.val; 
          tr.querySelector('.speedNum').value = data.speed; 
          saveRoles(); 
          renderRoles(); 
        }
      );
      
      tr.querySelectorAll('.pitchC').forEach(b => 
        b.onclick = () => { 
          data.pitch = b.dataset.val; 
          tr.querySelector('.pitchNum').value = data.pitch; 
          saveRoles(); 
          renderRoles(); 
        }
      );
      
      tr.querySelectorAll('.volC').forEach(b => 
        b.onclick = () => { 
          data.vol = b.dataset.val; 
          tr.querySelector('.volNum').value = data.vol; 
          saveRoles(); 
          renderRoles(); 
        }
      );
      
      tr.querySelector('.speedNum').oninput = (e) => { 
        data.speed = String(e.target.value || '100'); 
        saveRoles(); 
      };
      
      tr.querySelector('.pitchNum').oninput = (e) => { 
        data.pitch = String(e.target.value || '0'); 
        saveRoles(); 
      };
      
      tr.querySelector('.volNum').oninput = (e) => { 
        data.vol = String(e.target.value || '0'); 
        saveRoles(); 
      };
      
      tr.querySelector('.comfy').onclick = (e) => { 
        const btn = e.currentTarget; 
        const on = btn.getAttribute('aria-pressed') === 'true'; 
        btn.setAttribute('aria-pressed', String(!on)); 
        data.comfy = !on; 
        btn.classList.toggle('btn-primary', !on); 
        btn.classList.toggle('btn-secondary', on); 
        btn.textContent = (!on) ? 'ON' : 'OFF'; 
        if (data.comfy) { 
          data.speed = '92'; 
          data.pitch = '-2'; 
        } 
        saveRoles(); 
        renderRoles(); 
      };
      
      return tr;
    }
    
    function renderBaseVoiceSelect(){
      ensureBaseRole();
      const base = roles._;
      const langs = [...new Set(VOICES.flatMap(v => v.languageCodes || []))].sort();
      const langSel = $('baseLangSel');
      const voiceSel = $('baseVoiceSel');
      const voiceInfo = $('baseVoiceInfo');
      
      if (langSel && langs.length > 0) {
        langSel.innerHTML = langs.map(c => `<option ${base.lang === c ? 'selected' : ''} value="${c}">${c}</option>`).join('');
      }
      
      const curLang = langSel ? langSel.value : base.lang || 'ko-KR';
      const list = VOICES.filter(v => (v.languageCodes || []).includes(curLang));
      
      if (voiceSel) {
        voiceSel.innerHTML = `<option value="" ${!base.voice ? 'selected' : ''}>(ì„ íƒ)</option>` + 
          list.map(v => `<option ${base.voice === v.name ? 'selected' : ''} value="${v.name}">${formatVoiceOption(v)}</option>`).join('');
      }
      
      // ëª©ì†Œë¦¬ ì •ë³´ í‘œì‹œ
      if (voiceInfo && base.voice) {
        const selectedVoice = voiceIndex[base.voice];
        if (selectedVoice) {
          voiceInfo.innerHTML = formatVoiceInfo(selectedVoice);
        }
      } else if (voiceInfo) {
        voiceInfo.innerHTML = '';
      }
      
      if (langSel) {
        langSel.onchange = () => { 
          base.lang = langSel.value; 
          saveRoles(); 
          renderBaseVoiceSelect(); 
        };
      }
      
      if (voiceSel) {
        voiceSel.onchange = () => { 
          base.voice = voiceSel.value || ''; 
          saveRoles();
          renderBaseVoiceSelect(); // ì •ë³´ ì—…ë°ì´íŠ¸
        };
      }
      
      const previewBtn = $('basePreviewBtn');
      if (previewBtn) {
        previewBtn.onclick = () => {
          const voiceValue = voiceSel ? voiceSel.value || '' : '';
          const langValue = langSel ? langSel.value || 'ko-KR' : 'ko-KR';
          if (!voiceValue) return showError('ë¨¼ì € ëª©ì†Œë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”');
          previewVoice(voiceValue, langValue);
        };
      }
    }

    function renderRoles(){ 
      if (!roleBody) return;
      roleBody.innerHTML = ''; 
      ensureBaseRole(); 
      const keys = Object.keys(roles).sort((a, b) => a === '_' ? -1 : (b === '_' ? 1 : a.localeCompare(b))); 
      const roleCount = $('roleCount');
      if (roleCount) {
        roleCount.textContent = `ì´ ${keys.length}ê°œ ì´ë¦„`; 
      }
      keys.forEach(alias => roleBody.appendChild(roleRow(alias, roles[alias]))); 
    }

    on($('addRoleBtn'), 'click', () => { 
      const name = prompt('ì¶”ê°€í•  ì´ë¦„ (ì˜ˆ: í• ë¨¸ë‹ˆ)'); 
      if (!name) return; 
      roles[name] = {voice: '', speed: '100', pitch: '0', vol: '0', lang: 'ko-KR', comfy: false}; 
      saveRoles(); 
      renderRoles(); 
    });
    
    on($('resetRolesBtn'), 'click', () => { 
      if (!confirm('ëª¨ë“  ì´ë¦„ ì„¤ì •ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return; 
      roles = {}; 
      ensureBaseRole(); 
      saveRoles(); 
      renderRoles(); 
    });

    // ì´ë¦„ ìë™ì°¾ê¸°
    function parseDialogByAlias(text, resetEachLine){ 
      const lines = text.split(/\n/); 
      const parts = []; 
      let cur = '_'; 
      for (const raw of lines) { 
        const line = raw.trim(); 
        if (!line) { 
          parts.push({alias: resetEachLine ? '_' : cur, text: '\n'}); 
          continue;
        } 
        let m = line.match(/^([\w\uAC00-\uD7A3]{1,16}):\s*(.*)$/); 
        if (m) { 
          cur = m[1]; 
          parts.push({alias: cur, text: m[2]}); 
          if (resetEachLine) cur = '_'; 
          continue;
        } 
        m = line.match(/^\[([\w\uAC00-\uD7A3]{1,16})\]\s*(.*)$/); 
        if (m) { 
          cur = m[1]; 
          parts.push({alias: cur, text: m[2]}); 
          if (resetEachLine) cur = '_'; 
          continue;
        } 
        parts.push({alias: resetEachLine ? '_' : cur, text: line}); 
      }
      return parts.filter(p => p.text && p.text.trim()); 
    }
    
    function detectRoles(){ 
      const parts = parseDialogByAlias(editor.value, $('lineResetTgl').getAttribute('aria-pressed') === 'true'); 
      const uniq = new Set(parts.map(p => p.alias)); 
      ensureBaseRole(); 
      uniq.forEach(a => { 
        if (!roles[a]) roles[a] = {voice: '', speed: '100', pitch: '0', vol: '0', lang: 'ko-KR', comfy: (a === '_')}; 
      }); 
      saveRoles(); 
      renderRoles(); 
      showSuccess(`ì°¾ì€ ì´ë¦„: ${[...uniq].join(', ')}`); 
    }
    on($('detectBtn'), 'click', detectRoles);

    // í¸ì§‘ ë„ìš°ë¯¸
    on($('aliasBtn'), 'click', () => { 
      const name = prompt('ì„ íƒí•œ ë¬¸ì¥ì— ë¶™ì¼ ì´ë¦„ (ì˜ˆ: í• ë¨¸ë‹ˆ)'); 
      if (!name) return; 
      const ta = editor; 
      const s = ta.selectionStart, e = ta.selectionEnd; 
      const before = ta.value.slice(0, s), sel = ta.value.slice(s, e), after = ta.value.slice(e); 
      ta.value = `${before}${name}: ${sel}${after}`; 
      updateCounter(); 
    });
    
    on($('altBtn'), 'click', () => { 
      const A = prompt('ì²« ì¤„ ì´ë¦„(ì˜ˆ: A)'), B = prompt('ë‹¤ìŒ ì¤„ ì´ë¦„(ì˜ˆ: B)'); 
      if (!A || !B) return; 
      const lines = editor.value.split(/\n/); 
      let cur = A; 
      for (let i = 0; i < lines.length; i++) { 
        if (lines[i].trim()) { 
          lines[i] = `${cur}: ` + lines[i]; 
          cur = (cur === A ? B : A);
        } 
      } 
      editor.value = lines.join('\n'); 
      updateCounter(); 
    });

    // ì–¸ì–´ ìƒ˜í”Œ
    const LANG_SAMPLES = [
      { code: 'ko-KR', name: 'í•œêµ­ì–´(ëŒ€í•œë¯¼êµ­)', sample: 'ì•ˆë…•í•˜ì„¸ìš”. ì´ê²ƒì€ ìƒ˜í”Œ ë¬¸ì¥ì…ë‹ˆë‹¤.' },
      { code: 'en-US', name: 'ì˜ì–´(ë¯¸êµ­)', sample: 'Hello, this is a sample sentence.' },
      { code: 'en-GB', name: 'ì˜ì–´(ì˜êµ­)', sample: 'Hello, this is a sample sentence.' },
      { code: 'ja-JP', name: 'ì¼ë³¸ì–´', sample: 'ã“ã‚“ã«ã¡ã¯ã€‚ã“ã‚Œã¯ã‚µãƒ³ãƒ—ãƒ«æ–‡ã§ã™ã€‚' },
      { code: 'zh-CN', name: 'ì¤‘êµ­ì–´(ì¤‘êµ­ í‘œì¤€)', sample: 'ä½ å¥½ã€‚è¿™æ˜¯ä¸€å¥ç¤ºä¾‹å¥å­ã€‚' },
      { code: 'zh-TW', name: 'ì¤‘êµ­ì–´(ëŒ€ë§Œ)', sample: 'ä½ å¥½ã€‚é€™æ˜¯ä¸€å¥ç¯„ä¾‹ã€‚' },
      { code: 'de-DE', name: 'ë…ì¼ì–´', sample: 'Hallo, dies ist ein Beispielsatz.' },
      { code: 'fr-FR', name: 'í”„ë‘ìŠ¤ì–´', sample: 'Bonjour, ceci est une phrase exemple.' },
      { code: 'es-ES', name: 'ìŠ¤í˜ì¸ì–´(ìŠ¤í˜ì¸)', sample: 'Hola, esta es una frase de ejemplo.' },
      { code: 'it-IT', name: 'ì´íƒˆë¦¬ì•„ì–´', sample: 'Ciao, questa Ã¨ una frase di esempio.' },
      { code: 'ru-RU', name: 'ëŸ¬ì‹œì•„ì–´', sample: 'Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ. Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ.' },
      { code: 'pt-BR', name: 'í¬ë¥´íˆ¬ê°ˆì–´(ë¸Œë¼ì§ˆ)', sample: 'OlÃ¡, esta Ã© uma frase de exemplo.' }
    ];
    
    const voiceBody = document.querySelector('#voiceTable tbody');
    
    function renderSample(){ 
      const sel = $('sampleLang'); 
      if (!sel) return;
      sel.innerHTML = LANG_SAMPLES.map(x => `<option value="${x.code}">${x.name} â€” ${x.code}</option>`).join(''); 
      const saved = localStorage.getItem(LS.SAMPLE); 
      sel.value = saved || 'ko-KR'; 
      const it = LANG_SAMPLES.find(x => x.code === sel.value); 
      if (it && $('sampleText')) $('sampleText').value = it.sample; 
      renderVoiceList(); 
    }
    
    on($('sampleLang'), 'change', () => { 
      const sampleLang = $('sampleLang');
      if (!sampleLang) return;
      localStorage.setItem(LS.SAMPLE, sampleLang.value); 
      const it = LANG_SAMPLES.find(x => x.code === sampleLang.value); 
      if (it && $('sampleText')) $('sampleText').value = it.sample; 
      renderVoiceList(); 
    });
    
    function renderVoiceList(){ 
      if (!voiceBody) return;
      voiceBody.innerHTML = ''; 
      const sampleLang = $('sampleLang');
      if (!sampleLang) return;
      const lang = sampleLang.value; 
      const list = VOICES.filter(v => (v.languageCodes || []).includes(lang)); 
      
      list.forEach(v => { 
        const tr = document.createElement('tr'); 
        tr.innerHTML = `
        <td class="mono">${v.name}</td>
        <td>${formatVoiceInfo(v)}</td>
        <td><button class="btn btn-secondary small prevBtn">â–¶</button></td>
        <td><button class="btn btn-secondary small useBase">ê¸°ë³¸ ì´ë¦„</button></td>
        <td><button class="btn btn-secondary small useSelected">ì„ íƒ ì´ë¦„â€¦</button></td>`;
        
        tr.querySelector('.prevBtn').onclick = () => {
          const sampleText = $('sampleText');
          previewVoice(v.name, lang, sampleText ? sampleText.value : 'ì•ˆë…•í•˜ì„¸ìš”. ë¯¸ë¦¬ë“£ê¸°ì…ë‹ˆë‹¤.');
        };
        
        tr.querySelector('.useBase').onclick = () => { 
          ensureBaseRole(); 
          roles._.lang = lang; 
          roles._.voice = v.name; 
          saveRoles(); 
          renderRoles(); 
          renderBaseVoiceSelect();
          showSuccess('ê¸°ë³¸ ì´ë¦„ì— ì ìš©ë¨'); 
        };
        
        tr.querySelector('.useSelected').onclick = () => { 
          const keys = Object.keys(roles); 
          if (!keys.length) { 
            showError('ë¨¼ì € ì´ë¦„ì„ ì¶”ê°€í•˜ì„¸ìš”'); 
            return; 
          } 
          const name = prompt('ì–´ëŠ ì´ë¦„ì— ì“¸ê¹Œìš”? ' + keys.join(', ')); 
          if (!name || !roles[name]) return; 
          roles[name].lang = lang; 
          roles[name].voice = v.name; 
          saveRoles(); 
          renderRoles(); 
          showSuccess(`${name}ì— ì ìš©ë¨`); 
        };
        
        voiceBody.appendChild(tr); 
      }); 
    }

    // ìˆ˜ì •: MAX_BYTES ê°’ ë‚®ì¶¤ (ì•ˆì „ ë§ˆì§„ í™•ë³´)
    const MAX_BYTES = 4750;
    
    // ìˆ˜ì •: splitChunks í•¨ìˆ˜ - ì²­í¬ ê°„ break ì¶”ê°€ ë¡œì§ ì œê±°
    function splitChunks(text){ 
      const out = []; 
      const paras = text.split(/\n{2,}/); 
      for (const para of paras) { 
        if (!para.trim()) continue; 
        if (bCount(para) <= MAX_BYTES) { 
          out.push(para); 
          continue;
        } 
        const sents = para.split(/(?<=[\.\!\?\â€¦]|[ã€‚ï¼ï¼Ÿ])\s+/); 
        let buf = ''; 
        for (const s of sents) { 
          const cand = buf ? (buf + ' ' + s) : s; 
          if (bCount(cand) > MAX_BYTES) { 
            if (buf) out.push(buf); 
            if (bCount(s) > MAX_BYTES) { 
              let cur = s; 
              while (bCount(cur) > MAX_BYTES) { 
                let take = Math.floor(cur.length * 0.6); 
                while (take < cur.length && bCount(cur.slice(0, take)) <= MAX_BYTES) take++; 
                out.push(cur.slice(0, take - 1)); 
                cur = cur.slice(take - 1);
              } 
              if (cur.trim()) buf = cur; 
              else buf = ''; 
            } else { 
              buf = s; 
            } 
          } else { 
            buf = cand; 
          } 
        } 
        if (buf.trim()) out.push(buf);
      } 
      
      return out; 
    }
    
    function insertBreaks(str, ms, useSSML = true){ 
      if (!ms || ms === '0' || !useSSML) return str; 
      const parts = str.split(/(?<=[\.\!\?\â€¦]|[ã€‚ï¼ï¼Ÿ])\s+/); 
      return parts.join(` <break time="${ms}ms"/> `); 
    }

    async function synthesizeChunk({text, useSSML, voiceName, languageCode, rate, pitch, vol, encoding, sampleRate, effectsProfile}){
      const key = localStorage.getItem(LS.KEY); 
      if (!key) throw new Error('API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤');
      
      const voice = { languageCode }; 
      if (voiceName) voice.name = voiceName;
      
      const audioConfig = { 
        audioEncoding: encoding, 
        speakingRate: rate, 
        pitch: pitch, 
        volumeGainDb: vol, 
        sampleRateHertz: sampleRate 
      };
      
      // ì˜¤ë””ì˜¤ íš¨ê³¼ í”„ë¡œí•„ ì¶”ê°€
      if (effectsProfile) {
        audioConfig.effectsProfileId = [effectsProfile];
      }
      
      const url = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${encodeURIComponent(key)}`;
      const retries = Number($('retrySelect') ? $('retrySelect').value : '3');
      
      for (let attempt = 0; attempt <= retries; attempt++) {
        if (cancelRequested) throw new Error('ì‚¬ìš©ìê°€ ì·¨ì†Œí•¨');
        
        if (useSSML) {
          const ssmlBody = { 
            input: { ssml: `<speak>${text}</speak>` }, 
            voice, 
            audioConfig 
          };
          
          try {
            const r = await fetch(url, {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify(ssmlBody)
            });
            const j = await r.json();
            
            if (r.ok) return j.audioContent;
            
            if (j.error?.message?.includes('does not support SSML')) {
              console.warn('SSML ë¯¸ì§€ì› ìŒì„±, í…ìŠ¤íŠ¸ ëª¨ë“œë¡œ ì „í™˜:', voiceName);
              const textBody = { 
                input: { text: text.replace(/<[^>]*>/g, '') },
                voice, 
                audioConfig 
              };
              
              const r2 = await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(textBody)
              });
              const j2 = await r2.json();
              if (r2.ok) return j2.audioContent;
              if (attempt === retries) throw new Error(j2.error?.message || r2.statusText);
            } else {
              if (attempt === retries) throw new Error(j.error?.message || r.statusText);
            }
          } catch (fetchError) {
            if (attempt === retries) throw fetchError;
          }
        } else {
          const textBody = { 
            input: { text }, 
            voice, 
            audioConfig 
          };
          
          try {
            const r = await fetch(url, {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify(textBody)
            });
            const j = await r.json();
            if (r.ok) return j.audioContent;
            if (attempt === retries) throw new Error(j.error?.message || r.statusText);
          } catch (fetchError) {
            if (attempt === retries) throw fetchError;
          }
        }
        
        await sleep(300 * (attempt + 1));
      }
    }
    
    function b64ToU8(b64){ 
      const bin = atob(b64); 
      const u8 = new Uint8Array(bin.length); 
      for (let i = 0; i < bin.length; i++) u8[i] = bin.charCodeAt(i); 
      return u8; 
    }
    
    function concatWavFiles(wavArrays, sampleRate = 44100) {
      if (wavArrays.length === 0) return new Uint8Array();
      if (wavArrays.length === 1) return wavArrays[0];
      
      const WAV_HEADER_SIZE = 44;
      const audioDataArrays = wavArrays.map(wav => wav.slice(WAV_HEADER_SIZE));
      const totalAudioLength = audioDataArrays.reduce((sum, data) => sum + data.length, 0);
      const totalFileSize = WAV_HEADER_SIZE + totalAudioLength;
      
      const result = new Uint8Array(totalFileSize);
      const view = new DataView(result.buffer);
      
      // RIFF í—¤ë”
      view.setUint32(0, 0x52494646, false); // "RIFF"
      view.setUint32(4, totalFileSize - 8, true);
      view.setUint32(8, 0x57415645, false); // "WAVE"
      
      // fmt ì²­í¬
      view.setUint32(12, 0x666d7420, false); // "fmt "
      view.setUint32(16, 16, true);
      view.setUint16(20, 1, true);
      view.setUint16(22, 1, true);
      view.setUint32(24, sampleRate, true);
      view.setUint32(28, sampleRate * 2, true);
      view.setUint16(32, 2, true);
      view.setUint16(34, 16, true);
      
      // data ì²­í¬
      view.setUint32(36, 0x64617461, false); // "data"
      view.setUint32(40, totalAudioLength, true);
      
      let offset = WAV_HEADER_SIZE;
      for (const audioData of audioDataArrays) {
        result.set(audioData, offset);
        offset += audioData.length;
      }
      
      return result;
    }

    function concatU8(arrs, encoding = 'MP3', sampleRate = 44100){ 
      if (arrs.length === 0) return new Uint8Array();
      if (arrs.length === 1) return arrs[0];
      
      if (encoding === 'LINEAR16') {
        return concatWavFiles(arrs, sampleRate);
      }
      
      const totalSize = arrs.reduce((s, a) => s + a.length, 0);
      const out = new Uint8Array(totalSize); 
      let offset = 0; 
      for (const arr of arrs) { 
        out.set(arr, offset); 
        offset += arr.length;
      } 
      
      return out; 
    }

    async function previewVoice(name, lang, sample){ 
      try { 
        const sampleRate = Number($('sampleRateSelect') ? $('sampleRateSelect').value : '44100');
        const b64 = await synthesizeChunk({
          text: sample || 'ì•ˆë…•í•˜ì„¸ìš”. ë¯¸ë¦¬ë“£ê¸°ì…ë‹ˆë‹¤.', 
          useSSML: false, 
          voiceName: name, 
          languageCode: lang || 'ko-KR', 
          rate: 1.0, 
          pitch: 0, 
          vol: 0, 
          encoding: 'MP3', 
          sampleRate: sampleRate
        }); 
        const url = URL.createObjectURL(new Blob([b64ToU8(b64)], {type: 'audio/mpeg'})); 
        new Audio(url).play(); 
      } catch (e) { 
        showError('ë¯¸ë¦¬ë“£ê¸° ì‹¤íŒ¨: ' + parseError(e));
      } 
    }

    // ìˆ˜ì •: buildSegments í•¨ìˆ˜ ì™„ì „ ì¬ì‘ì„±
    function buildSegments(){ 
      const text = editor.value; 
      const enc = $('encodingSelect') ? $('encodingSelect').value : 'MP3';
      const sr = Number($('sampleRateSelect') ? $('sampleRateSelect').value : '44100');
      const sp = $('sentenceBreakSelect') ? $('sentenceBreakSelect').value : '300';
      const sw = $('switchSelect') ? $('switchSelect').value : '150';
      const lineReset = $('lineResetTgl') ? $('lineResetTgl').getAttribute('aria-pressed') === 'true' : true;
      const chunkOn = $('chunkTgl') ? $('chunkTgl').getAttribute('aria-pressed') === 'true' : true;
      const effectsProfile = $('effectsProfileSel') ? $('effectsProfileSel').value : '';
      
      const segs = []; 
      
      // ìˆ˜ì •: splitChunksëŠ” ìˆœìˆ˜í•˜ê²Œ ë¶„í• ë§Œ ìˆ˜í–‰ (break íƒœê·¸ ì¶”ê°€ ì•ˆ í•¨)
      const splitter = chunkOn ? (t) => splitChunks(t) : (t) => [t];
      
      if (mode === 'ssml') {
        const chunks = splitter(text);
        const base = roles._ || {voice: '', speed: '100', pitch: '0', vol: '0', lang: 'ko-KR'};
        chunks.forEach((ch, idx) => {
          // ì²­í¬ ê°„ ì—°ê²° break (ë§ˆì§€ë§‰ ì œì™¸)
          const chunkBreak = (idx < chunks.length - 1) ? ` <break time="${sp}ms"/>` : '';
          segs.push({ 
            alias: 'ê¸°ë³¸', 
            text: ch + chunkBreak, 
            ssml: true, 
            voice: base.voice, 
            lang: base.lang, 
            rate: Number(base.speed) / 100, 
            pitch: Number(base.pitch), 
            vol: Number(base.vol),
            effectsProfile: effectsProfile
          });
        });
      } else if (mode === 'plain') {
        const base = roles._ || {voice: '', speed: '100', pitch: '0', vol: '0', lang: 'ko-KR'};
        const plainSpeed = $('plainSpeedSlider') ? Number($('plainSpeedSlider').value) / 100 : Number(base.speed) / 100;
        const plainPitch = $('plainPitchSlider') ? Number($('plainPitchSlider').value) : Number(base.pitch);
        const plainVolume = $('plainVolumeSlider') ? Number($('plainVolumeSlider').value) : Number(base.vol);
        
        const isAdvancedVoice = base.voice && (base.voice.includes('Neural') || base.voice.includes('Wavenet') || base.voice.includes('Chirp'));
        
        // ìˆ˜ì •: ë¨¼ì € ì²­í¬ë¡œ ë‚˜ëˆ„ê³ , ê° ì²­í¬ì— break ì¶”ê°€
        const chunks = splitter(text);
        chunks.forEach((ch, idx) => {
          const inner = insertBreaks(ch, sp, isAdvancedVoice);
          // ë§ˆì§€ë§‰ ì²­í¬ê°€ ì•„ë‹ˆë©´ ì²­í¬ ëì— break ì¶”ê°€
          const chunkBreak = (idx < chunks.length - 1 && isAdvancedVoice) ? ` <break time="${sp}ms"/>` : '';
          
          segs.push({ 
            alias: 'ê¸°ë³¸', 
            text: inner + chunkBreak, 
            ssml: isAdvancedVoice, 
            voice: base.voice, 
            lang: base.lang, 
            rate: plainSpeed, 
            pitch: plainPitch, 
            vol: plainVolume,
            effectsProfile: effectsProfile
          });
        });
      } else { // dialog
        const parts = parseDialogByAlias(text, lineReset);
        
        // ìˆ˜ì •: ë¨¼ì € ì—­í• ë³„ë¡œ í…ìŠ¤íŠ¸ë¥¼ ê·¸ë£¹í™”
        let currentAlias = parts[0]?.alias || '_';
        let buffer = '';
        const roleGroups = [];
        
        for (let i = 0; i < parts.length; i++) {
          const cur = parts[i];
          const next = parts[i + 1];
          
          if (cur.alias !== currentAlias) {
            // ì—­í• ì´ ë°”ë€Œë©´ ì´ì „ ë²„í¼ ì €ì¥
            if (buffer) {
              roleGroups.push({alias: currentAlias, text: buffer, isLast: false});
              buffer = '';
            }
            currentAlias = cur.alias;
          }
          
          buffer += (buffer ? ' ' : '') + cur.text;
          
          // ë‹¤ìŒ ì—­í• ì´ ë‹¤ë¥´ê±°ë‚˜ ë§ˆì§€ë§‰ì´ë©´ ì €ì¥
          if (!next || next.alias !== currentAlias) {
            roleGroups.push({alias: currentAlias, text: buffer, isLast: !next});
            buffer = '';
            if (next) currentAlias = next.alias;
          }
        }
        
        // ê° ì—­í•  ê·¸ë£¹ì„ ì²­í¬ë¡œ ë¶„í• í•˜ê³  ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±
        roleGroups.forEach((group, groupIdx) => {
          const r = roles[group.alias] || roles._ || {voice: '', speed: '100', pitch: '0', vol: '0', lang: 'ko-KR'};
          const isAdvancedVoice = r.voice && (r.voice.includes('Neural') || r.voice.includes('Wavenet') || r.voice.includes('Chirp'));
          
          const chunks = splitter(group.text);
          chunks.forEach((ch, chunkIdx) => {
            const inner = insertBreaks(ch, sp, isAdvancedVoice);
            
            // break íƒœê·¸ ê²°ì •
            let endBreak = '';
            if (chunkIdx < chunks.length - 1) {
              // ê°™ì€ ì—­í•  ë‚´ ì²­í¬ ê°„
              endBreak = isAdvancedVoice ? ` <break time="${sp}ms"/>` : '';
            } else if (!group.isLast) {
              // ì—­í•  ì „í™˜
              endBreak = isAdvancedVoice ? ` <break time="${sw}ms"/>` : '';
            }
            
            segs.push({ 
              alias: group.alias, 
              text: inner + endBreak, 
              ssml: isAdvancedVoice, 
              voice: r.voice, 
              lang: r.lang, 
              rate: Number(r.speed) / 100, 
              pitch: Number(r.pitch), 
              vol: Number(r.vol),
              effectsProfile: effectsProfile
            });
          });
        });
      }
      
      return {segs, enc, sr};
    }

    // ì·¨ì†Œ ë²„íŠ¼
    on($('cancelBtn'), 'click', () => {
      cancelRequested = true;
      $('cancelBtn').style.display = 'none';
    });
    
    on($('makeBtn'), 'click', async () => {
      if (!localStorage.getItem(LS.KEY)) return showError('ë¨¼ì € API í‚¤ë¥¼ ì €ì¥í•˜ì„¸ìš”');
      if (VOICES.length === 0) await loadVoices();
      
      if (mode !== 'ssml') {
        if (mode === 'plain') { 
          if (!(roles._ && roles._.voice)) return showError('ì¼ë°˜ ëª¨ë“œ: ê¸°ë³¸ ì´ë¦„ì˜ ëª©ì†Œë¦¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”'); 
        }
        if (mode === 'dialog') {
          const missing = []; 
          Object.keys(roles).forEach(k => { 
            if (!roles[k].voice) missing.push(k); 
          }); 
          if (missing.length > 0) return showError('ì•„ë˜ ì´ë¦„ ì„¤ì •í‘œì—ì„œ ëª©ì†Œë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”:\n' + missing.join(', '));
        }
      }
      
      const makeBtn = $('makeBtn');
      const cancelBtn = $('cancelBtn');
      const status = $('status');
      const progressBar = $('progressBar');
      const progressFill = $('progressFill');
      
      makeBtn.disabled = true; 
      cancelBtn.style.display = 'inline';
      progressBar.style.display = 'block';
      cancelRequested = false;
      status.textContent = 'ì‹œì‘í•©ë‹ˆë‹¤â€¦';
      
      // ì´ì „ ì˜¤ë””ì˜¤ URL ì •ë¦¬
      activeAudioUrls.forEach(url => URL.revokeObjectURL(url));
      activeAudioUrls = [];
      
      try {
        const {segs, enc, sr} = buildSegments();
        const parts = []; 
        
        for (let i = 0; i < segs.length; i++) {
          if (cancelRequested) {
            throw new Error('ì‚¬ìš©ìê°€ ì·¨ì†Œí•¨');
          }
          
          status.textContent = `ë§Œë“œëŠ” ì¤‘â€¦ (${i + 1}/${segs.length})`;
          progressFill.style.width = `${((i + 1) / segs.length) * 100}%`;
          
          const s = segs[i];
          const b64 = await synthesizeChunk({
            text: s.text, 
            useSSML: s.ssml, 
            voiceName: s.voice, 
            languageCode: s.lang, 
            rate: s.rate, 
            pitch: s.pitch, 
            vol: s.vol, 
            encoding: enc, 
            sampleRate: sr,
            effectsProfile: s.effectsProfile
          });
          const u8 = b64ToU8(b64); 
          parts.push(u8);
          await sleep(8);
        }
        
        const bytes = concatU8(parts, enc, sr); 
        const mime = (enc === 'OGG_OPUS' ? 'audio/ogg' : (enc === 'LINEAR16' ? 'audio/wav' : 'audio/mpeg')); 
        const url = URL.createObjectURL(new Blob([bytes], {type: mime}));
        activeAudioUrls.push(url);
        
        const player = $('player');
        if (player) player.src = url; 
        
        const ext = (enc === 'OGG_OPUS' ? 'ogg' : (enc === 'LINEAR16' ? 'wav' : 'mp3'));
        const name = `tts-output-${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.${ext}`; 
        const dl = $('download'); 
        if (dl) {
          dl.style.display = 'inline'; 
          dl.href = url; 
          dl.download = name; 
        }
        
        const outInfo = $('outInfo');
        if (outInfo) {
          outInfo.textContent = `${(bytes.length / 1024).toFixed(1)} KB Â· ${segs.length} ì¡°ê°`; 
        }
        status.textContent = 'ì™„ë£Œ';
        progressFill.style.width = '100%';
      } catch (e) { 
        console.error(e); 
        showError('ì˜¤ë¥˜: ' + parseError(e)); 
        status.textContent = 'ì‹¤íŒ¨'; 
        progressFill.style.width = '0%';
      }
      
      makeBtn.disabled = false;
      cancelBtn.style.display = 'none';
      setTimeout(() => {
        progressBar.style.display = 'none';
      }, 2000);
    });

    // ëª¨ë‘ ë“£ê¸° í¸í•˜ê²Œ ë²„íŠ¼
    on($('seniorAllBtn'), 'click', () => {
      if (!confirm('ëª¨ë“  ì´ë¦„ì„ ë“£ê¸° í¸í•œ ì„¤ì •(ì†ë„ 92%, í†¤ -2)ìœ¼ë¡œ ë³€ê²½í• ê¹Œìš”?')) return;
      Object.keys(roles).forEach(alias => {
        roles[alias].speed = '92';
        roles[alias].pitch = '-2';
        roles[alias].comfy = true;
      });
      saveRoles();
      renderRoles();
      showSuccess('ëª¨ë“  ì´ë¦„ì´ ë“£ê¸° í¸í•œ ì„¤ì •ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
    });

    // ì´ˆê¸°í™”
    (async function init(){ 
      updateApiBadge(); 
      setMode(mode);
      const o = loadOpts();
      
      // ì˜µì…˜ ë³µì›
      if ($('encodingSelect')) $('encodingSelect').value = o.encoding || 'MP3';
      if ($('sampleRateSelect')) $('sampleRateSelect').value = o.sampleRate || '44100';
      if ($('sentenceBreakSelect')) $('sentenceBreakSelect').value = o.sentenceBreak || '300';
      if ($('switchSelect')) $('switchSelect').value = o.switchDelay || '150';
      if ($('retrySelect')) $('retrySelect').value = o.retry || '3';
      if ($('effectsProfileSel')) $('effectsProfileSel').value = o.effectsProfile || '';
      
      const normTgl = $('normTgl');
      if (normTgl) {
        normTgl.setAttribute('aria-pressed', String(o.norm !== false)); 
        normTgl.classList.toggle('btn-primary', o.norm !== false); 
        normTgl.classList.toggle('btn-secondary', o.norm === false); 
        normTgl.textContent = (o.norm === false ? 'OFF' : 'ON');
      }
      
      const chunkTgl = $('chunkTgl');
      if (chunkTgl) {
        chunkTgl.setAttribute('aria-pressed', String(o.chunk !== false)); 
        chunkTgl.classList.toggle('btn-primary', o.chunk !== false); 
        chunkTgl.classList.toggle('btn-secondary', o.chunk === false); 
        chunkTgl.textContent = (o.chunk === false ? 'OFF' : 'ON');
      }
      
      const lineResetTgl = $('lineResetTgl');
      if (lineResetTgl) {
        lineResetTgl.setAttribute('aria-pressed', String(o.lineReset !== false)); 
        lineResetTgl.classList.toggle('btn-primary', o.lineReset !== false); 
        lineResetTgl.classList.toggle('btn-secondary', o.lineReset === false); 
        lineResetTgl.textContent = (o.lineReset === false ? 'OFF' : 'ON');
      }
      
      // ì¼ë°˜ ëª¨ë“œ ìŠ¬ë¼ì´ë” ë³µì›
      if ($('plainSpeedSlider')) {
        $('plainSpeedSlider').value = o.plainSpeed || '100';
        $('plainSpeedValue').textContent = (o.plainSpeed || '100') + '%';
      }
      if ($('plainPitchSlider')) {
        $('plainPitchSlider').value = o.plainPitch || '0';
        $('plainPitchValue').textContent = o.plainPitch || '0';
      }
      if ($('plainVolumeSlider')) {
        $('plainVolumeSlider').value = o.plainVolume || '0';
        $('plainVolumeValue').textContent = (o.plainVolume || '0') + 'dB';
      }
      
      // API í‚¤ ë³µì›
      const savedKey = localStorage.getItem(LS.KEY);
      if (savedKey && apiKey) {
        apiKey.value = savedKey;
      }
      
      try {
        await loadVoices(); 
      } catch (e) {
        console.warn('ìŒì„± ë¡œë“œ ì‹¤íŒ¨:', e.message);
      }
      
      ensureBaseRole(); 
      renderRoles(); 
      renderSample(); 
      renderBaseVoiceSelect(); 
      updateCounter(); 
      autosave();
      
      // í˜ì´ì§€ ë– ë‚  ë•Œ ë©”ëª¨ë¦¬ ì •ë¦¬
      window.addEventListener('beforeunload', () => {
        activeAudioUrls.forEach(url => URL.revokeObjectURL(url));
      });
    })();

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (HTMLì—ì„œ í˜¸ì¶œìš©)
    window.setPlainSpeed = setPlainSpeed;
    window.setPlainPitch = setPlainPitch;
    window.setPlainVolume = setPlainVolume;
  </script>
</body>
</html>