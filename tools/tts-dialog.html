<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ â€” ì—­í•  ë‚­ë… ë„êµ¬ (í•œêµ­ì–´)</title>
  <meta name="description" content="BYO Google TTS. ì—­í•  ëŒ€í™”/ì¼ë°˜/ì„¸ë°€ ì¡°ì ˆ. ìë™ ì €ì¥ ì˜µì…˜, ì–¸ì–´ë³„ ë³´ì´ìŠ¤ ë¯¸ë¦¬ë“£ê¸°, ê¸´ ê¸€ ìë™ ë‚˜ëˆ”, ìë§‰ ì €ì¥. ì¤„ë§ˆë‹¤ ì—­í•  ì´ˆê¸°í™” ì§€ì›. ì‚¬ì´íŠ¸ ê³µí†µ UI/í…Œë§ˆ í†µì¼." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="/tools/tts-dialog.html" />
  <link rel="alternate" hreflang="ko" href="/tools/tts-dialog.html" />
  <link rel="alternate" hreflang="en" href="/en/tools/tts-dialog.html" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
  <meta property="og:title" content="ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ â€” ì—­í•  ë‚­ë… ë„êµ¬ (í•œêµ­ì–´)" />
  <meta property="og:description" content="Google Cloud TTSë¡œ ë‚´ APIí‚¤ë¡œ í•©ì„±. ì—­í•  ëŒ€í™”/ì¼ë°˜/ì„¸ë°€ ì¡°ì ˆ, ê¸´ ê¸€ ìë™ ë‚˜ëˆ”, ìë§‰ ì €ì¥, ì–¸ì–´ë³„ ë³´ì´ìŠ¤ ìƒ˜í”Œ." />
  <meta property="og:image" content="/assets/og-tool-tts-dialog.png" />
  <meta property="og:url" content="/tools/tts-dialog.html" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ko_KR" />

  <!-- Theme bootstrap (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <script>
    (function(){
      try{
        const saved=localStorage.getItem('theme');
        if(saved==='light'||saved==='dark'){
          document.documentElement.setAttribute('data-theme',saved);
          document.documentElement.setAttribute('data-user-theme','1');
        }else{
          const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
          document.documentElement.setAttribute('data-theme',prefersDark?'dark':'light');
        }
      }catch(e){}
    })();
  </script>

  <!-- GTM (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-N2BBPNCC');</script>

  <!-- AdSense (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3006330103681332" crossorigin="anonymous"></script>

  <!-- ê³µí†µ ìŠ¤íƒ€ì¼ í† í° (ì‚¬ì´íŠ¸ ê³µí†µ ë²„íŠ¼/ë ˆì´ì•„ì›ƒê³¼ í†µì¼) -->
  <style>
    :root{ --bg:#ffffff; --text:#0b1220; --muted:#475569; --border:#e5e7eb; --card:#ffffff; --accent:#2563eb; --btn-text:#ffffff; --shadow:0 6px 18px rgba(0,0,0,.06); --focus: color-mix(in srgb, var(--accent) 35%, transparent); --input:#0b1220; --input-bg:var(--card); --hero-tint:#eff3ff; --hero-grid:#e8ecf6; --hero-ring:#cfe1ff }
    [data-theme="dark"]{ --bg:#0b1220; --text:#f1f5f9; --muted:#cbd5e1; --border:#334155; --card:#111827; --accent:#60a5fa; --btn-text:#0b1220; --shadow:0 8px 22px rgba(0,0,0,.55); --focus: color-mix(in srgb, var(--accent) 45%, transparent); --input:#e5e7eb; --input-bg:#0f172a; --hero-tint:#0f172a; --hero-grid:#162036; --hero-ring:#1f3b76 }
    html,body{background:var(--bg)!important}
    body{color:var(--text)!important;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:1120px;margin:0 auto;padding:0 16px}

    /* Header ê³µí†µ */
    header.site{position:sticky;top:0;z-index:100;background:var(--bg)!important;border-bottom:1px solid var(--border)}
    .brand{color:var(--text)!important;font-weight:800;text-decoration:none}
    header.site nav{display:flex;align-items:center;gap:12px}
    .lang-switch,.theme-toggle,.btn{padding:.5rem .72rem;border:1px solid var(--border);border-radius:.7rem;background:linear-gradient(180deg,color-mix(in srgb,var(--card)96%,transparent),var(--card));cursor:pointer;color:var(--text)!important;box-shadow:var(--shadow);transition:transform .06s,box-shadow .18s,border-color .18s,background .18s}
    .lang-switch:hover,.theme-toggle:hover,.theme-toggle:focus-visible,.btn:hover{color:var(--accent)!important;border-color:var(--accent)!important;box-shadow:0 0 0 3px var(--focus), var(--shadow)}
    .theme-toggle:active,.btn:active{transform:translateY(1px)}
    .theme-toggle[aria-pressed="true"], .btn-primary{background:linear-gradient(180deg,color-mix(in srgb,var(--accent)22%,var(--card)),var(--accent));border-color:var(--accent)!important;color:var(--btn-text)!important}
    .btn-secondary{background:linear-gradient(180deg, color-mix(in srgb, var(--card) 95%, transparent), var(--card))}
    .btn-danger{background:linear-gradient(180deg,color-mix(in srgb,#ef4444 20%,var(--card)),#ef4444);border-color:#ef4444;color:#fff}

    /* Hero ê³µí†µ */
    .hero{position:relative;overflow:hidden;padding:28px 0 18px;text-align:start;isolation:isolate}
    .hero::before{content:"";position:absolute;inset:0;background:radial-gradient(900px 360px at 50% -15%, var(--hero-ring), transparent 65%),linear-gradient(180deg, color-mix(in srgb, var(--hero-tint) 88%, transparent), transparent 60%);z-index:-2}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(to right, color-mix(in srgb,var(--hero-grid) 35%, transparent) 1px, transparent 1px) 0 0/28px 28px,linear-gradient(to bottom, color-mix(in srgb,var(--hero-grid) 35%, transparent) 1px, transparent 1px) 0 0/28px 28px;opacity:.5;z-index:-1}
    .hero h1{margin:0;font-size:clamp(1.6rem,3.4vw,2.2rem)} .hero p{margin:.4rem 0 0;color:var(--muted);max-width:900px}
    .crumb{margin:10px 0 0;font-size:.95rem}.crumb a{color:var(--muted)} .hl{background:color-mix(in srgb, var(--accent) 14%, transparent);padding:0 4px;border-radius:6px}

    /* Panels ê³µí†µ */
    main .section{margin:12px 0}
    .ad-space{margin:8px 0}
    .panel{border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg, color-mix(in srgb, var(--card) 95%, transparent), var(--card));box-shadow:var(--shadow);padding:12px}
    .panel h2{margin:.1rem 0 .6rem;font-size:1.06rem}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.row{grid-template-columns:1fr 1fr}}
    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .small{font-size:.92rem;color:var(--muted)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}

    /* Inputs */
    textarea.input{width:100%;min-height:260px;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--input-bg);color:var(--input);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.98rem;line-height:1.45;resize:vertical;white-space:pre-wrap}
    textarea.output{width:100%;min-height:220px;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.98rem;line-height:1.45;resize:vertical}
    select,input[type=text],input[type=password],input[type=number]{width:100%;padding:.6rem .72rem;border:1px solid var(--border);border-radius:.7rem;background:var(--input-bg);color:var(--input)}

    /* Tables & lists */
    .list{max-height:320px;overflow:auto;border:1px dashed var(--border);border-radius:10px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border);padding:6px 8px;text-align:left}

    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted)}
    .counter{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:.92rem;margin-top:6px}
  </style>
</head>
<body>
  <!-- GTM (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N2BBPNCC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Header (ì‚¬ì´íŠ¸ ê³µí†µ) -->
  <header class="site">
    <div class="container" style="display:flex;justify-content:space-between;align-items:center">
      <a href="/" class="brand">Thenaom Tools</a>
      <nav aria-label="ë³´ì¡° íƒìƒ‰">
        <a class="lang-switch" href="/en/tools/tts-dialog.html" hreflang="en">English</a>
        <button id="themeToggle" class="theme-toggle" aria-pressed="false" title="í…Œë§ˆ ì „í™˜"><span class="icon">ğŸŒ</span><span class="label">ë¼ì´íŠ¸</span></button>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <div class="crumb"><a href="/">í™ˆ</a> &nbsp;>&nbsp; <a href="/audio/">ì˜¤ë””ì˜¤</a> &nbsp;>&nbsp; ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ</div>
      <h1>ë¬¸ìë¥¼ ìŒì„±ìœ¼ë¡œ â€” <span class="hl">ì—­í•  ë‚­ë… ë„êµ¬</span> (í•œêµ­ì–´)</h1>
      <p>ë‚´ Google Cloud TTS <span class="hl">API í‚¤</span>ë¡œ, ëŒ€í™”ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í•©ì„±í•©ë‹ˆë‹¤. <b>ì—­í•  ëŒ€í™”/ì¼ë°˜/ì„¸ë°€ ì¡°ì ˆ</b>ì„ ì§€ì›í•˜ê³ , <b>ê¸´ ê¸€ ìë™ ë‚˜ëˆ”</b>ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì´ì–´ë¶™ì…ë‹ˆë‹¤.</p>
    </div>
  </section>

  <main class="container" id="main">
    <!-- ìƒë‹¨ ê´‘ê³  -->
    <div class="ad-space"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3006330103681332" data-ad-slot="6703005412" data-ad-format="auto" data-full-width-responsive="true"></ins></div>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>

    <!-- ë¯¸ë‹ˆ ìƒíƒœì¤„: API ì €ì¥ ì—¬ë¶€ -->
    <section class="section">
      <div class="panel" id="miniBar" style="display:flex;align-items:center;gap:10px;justify-content:space-between">
        <div class="controls">
          <span id="apiBadge" class="btn" style="pointer-events:none">API ì…ë ¥ í•„ìš”</span>
          <span class="small" id="apiMiniText">API í‚¤ë¥¼ ì €ì¥í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”</span>
        </div>
        <div class="controls small">
          <span>ëª¨ë“œ: <b id="modeMini">ì—­í•  ëŒ€í™”</b></span>
        </div>
      </div>
    </section>

    <!-- ì…ë ¥ & ì‹¤í–‰ -->
    <section class="section">
      <div class="row">
        <!-- ì…ë ¥ íŒ¨ë„ -->
        <div class="panel" aria-label="ì…ë ¥">
          <h2>1) í…ìŠ¤íŠ¸ ì…ë ¥</h2>
          <div class="controls" style="margin-bottom:6px">
            <div role="tablist" aria-label="ëª¨ë“œ" class="controls" id="modeChips">
              <button class="btn btn-secondary" data-val="plain" aria-pressed="false">ì¼ë°˜</button>
              <button class="btn btn-primary" data-val="dialog" aria-pressed="true">ì—­í•  ëŒ€í™”</button>
              <button class="btn btn-secondary" data-val="ssml" aria-pressed="false">ì„¸ë°€ ì¡°ì ˆ(ì „ë¬¸ê°€ìš©)</button>
            </div>
            <span id="modeHint" class="small"></span>
          </div>
          <textarea id="editor" class="input mono" placeholder="ì˜ˆ: í• ë¨¸ë‹ˆ: ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì.\nì†Œë…„: ì•„ì§ í•  ë§ì´ ìˆì–´ìš”!"></textarea>
          <div class="counter" id="counter">0 ê¸€ì / 0 ë°”ì´íŠ¸</div>

          <!-- â˜… ìš”ì²­: ê¸´ ê¸€ ìë™ ë‚˜ëˆ”ì„ í…ìŠ¤íŠ¸ ì…ë ¥ í•˜ë‹¨ìœ¼ë¡œ ì´ë™ -->
          <div class="panel" style="margin-top:10px">
            <div class="controls">
              <label for="chunkTgl" class="small" style="min-width:160px">ê¸´ ê¸€ ìë™ ë‚˜ëˆ”</label>
              <button id="chunkTgl" class="btn btn-secondary" aria-pressed="true">ON</button>
              <span class="small">ìš”ì²­ 1íšŒë‹¹ <b>5,000ë°”ì´íŠ¸</b> ì œí•œ. <b>í•œê¸€ ê¸°ì¤€ ëŒ€ëµ 1,600ì</b>ë¥¼ ë„˜ìœ¼ë©´ <b>ì˜¤ë¥˜</b>ê°€ ë‚  ìˆ˜ ìˆì–´ìš”. ì´ ê¸°ëŠ¥ì„ <b>ì¼œë‘ë©´</b> ê¸¸ì´ë¥¼ ìë™ìœ¼ë¡œ ë‚˜ëˆ ì„œ ì´ì–´ë¶™ì…ë‹ˆë‹¤.</span>
            </div>
          </div>

          <!-- ì—­í•  ëŒ€í™” ì „ìš© ì˜µì…˜: ì…ë ¥ ë°”ë¡œ ì•„ë˜ í‘œì‹œ -->
          <div id="dialogOptBlock" class="panel" style="margin-top:10px">
            <div class="controls">
              <div style="min-width:200px">
                <label class="small">ë§ ë°”ë€” ë•Œ ì ê¹ ì‰¬ê¸°(ms)</label>
                <div class="controls">
                  <div id="switchChips" class="controls" role="group">
                    <button class="btn btn-secondary" data-val="0">0</button>
                    <button class="btn btn-primary" data-val="150">150 (ì¶”ì²œ)</button>
                    <button class="btn btn-secondary" data-val="300">300</button>
                  </div>
                  <input id="switchNum" type="number" min="0" max="2000" step="10" placeholder="ì§ì ‘ ì…ë ¥" style="width:130px" />
                </div>
                <div class="small" style="margin-top:4px;color:var(--muted)">ë§í•˜ëŠ” ì‚¬ëŒì´ ë°”ë€ŒëŠ” ì§€ì ì—ë§Œ ì§§ê²Œ ì‰¬ì–´ ë” ìì—°ìŠ¤ëŸ½ê²Œ ë“¤ë¦½ë‹ˆë‹¤.</div>
              </div>

              <div>
                <label class="small">ì¤„ë§ˆë‹¤ ê¸°ë³¸ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°</label>
                <button id="lineResetTgl" class="btn btn-primary" aria-pressed="true">ON</button>
                <div class="small" style="margin-top:4px;color:var(--muted)">ONì´ë©´ <b>ê·¸ ì¤„ì— ì íŒ ì´ë¦„ë§Œ</b> í•´ë‹¹ ëª©ì†Œë¦¬ë¡œ ì½ê³ , ë‹¤ìŒ ì¤„ì€ ìë™ìœ¼ë¡œ <b>ê¸°ë³¸ ëª©ì†Œë¦¬</b>ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</div>
              </div>
            </div>

            <!-- ì—­í•  í‘œ -->
            <div style="margin-top:10px">
              <div class="controls" style="justify-content:space-between">
                <div class="controls">
                  <strong>ì´ë¦„ ì„¤ì •í‘œ</strong>
                </div>
                <div class="controls">
                  <button id="detectBtn" class="btn btn-secondary small">ì´ë¦„ ìë™ì°¾ê¸°</button>
                  <button id="addRoleBtn" class="btn btn-secondary small">ì´ë¦„ ì¶”ê°€</button>
                  <button id="seniorAllBtn" class="btn btn-secondary small">ëª¨ë‘ ë“£ê¸° í¸í•˜ê²Œ</button>
                  <button id="resetRolesBtn" class="btn btn-danger small">ì´ˆê¸°í™”</button>
                </div>
              </div>
              <div class="list" style="margin-top:6px">
                <table class="small" id="roleTable">
                  <thead><tr><th>ì´ë¦„</th><th>ëª©ì†Œë¦¬</th><th>â–¶</th><th>ì†ë„(%)</th><th>í†¤(semi)</th><th>ë³¼ë¥¨(dB)</th><th>ë“£ê¸° í¸í•¨</th><th>ì–¸ì–´</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
              <div class="small" id="roleCount" style="margin-top:6px;color:var(--muted)"></div>
            </div>

            <!-- ì„ íƒ ë„êµ¬ -->
            <div class="controls small" style="margin-top:8px">
              <button id="aliasBtn" class="btn btn-secondary">ì„ íƒí•œ ë¬¸ì¥ì— ì´ë¦„ ë¶™ì´ê¸°</button>
              <button id="altBtn" class="btn btn-secondary">ì—¬ëŸ¬ ì¤„ì— A/B ë²ˆê°ˆì•„ ë¶™ì´ê¸°</button>
            </div>
          </div>
        </div>

        <!-- ì‹¤í–‰ íŒ¨ë„ -->
        <div class="panel" aria-label="ì‹¤í–‰">
          <h2>2) ìŒì„± ë§Œë“¤ê¸°</h2>
          <div class="controls">
            <button id="makeBtn" class="btn btn-primary"><span id="makeLabel">ìŒì„± ë§Œë“¤ê¸°</span></button>
            <span id="status" class="small" style="margin-left:6px"></span>
            <a id="download" class="small" href="#" style="display:none;text-decoration:underline;margin-left:auto">ë‹¤ìš´ë¡œë“œ</a>
          </div>
          <audio id="player" controls style="margin-top:8px;width:100%"></audio>
          <div class="controls small" style="margin-top:6px">
            <button id="srtBtn" class="btn btn-secondary">SRT ìë§‰ ì €ì¥</button>
            <button id="vttBtn" class="btn btn-secondary">VTT ìë§‰ ì €ì¥</button>
            <span class="small" id="outInfo" style="margin-left:auto"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- ì˜µì…˜ & ìƒ˜í”Œ -->
    <section class="section">
      <div class="row">
        <!-- ì˜µì…˜ (ê³µí†µ) -->
        <div class="panel">
          <h2>3) ì˜µì…˜ì°½</h2>
          <div class="row">
            <div>
              <h3>ì¶œë ¥</h3>
              <div class="controls">
                <label style="min-width:90px">í˜•ì‹</label>
                <div id="encChips" class="controls" role="group">
                  <button class="btn btn-primary" data-val="MP3">MP3</button>
                  <button class="btn btn-secondary" data-val="OGG_OPUS">OGG</button>
                </div>
              </div>
              <div class="controls" style="margin-top:6px">
                <label style="min-width:90px">ìƒ˜í”Œë ˆì´íŠ¸</label>
                <div id="srChips" class="controls" role="group">
                  <button class="btn btn-secondary" data-val="24000">24k</button>
                  <button class="btn btn-primary" data-val="44100">44.1k</button>
                  <button class="btn btn-secondary" data-val="48000">48k</button>
                </div>
                <input id="srNum" type="number" min="8000" max="48000" step="1" placeholder="ì§ì ‘ ì…ë ¥" style="width:130px" />
              </div>
            </div>

            <div>
              <h3>ë¬¸ì¥ ì‰¬ê¸°</h3>
              <div class="controls">
                <label style="min-width:120px">ë¬¸ì¥ ì‚¬ì´ ì‰¬ê¸°(ms)</label>
                <div id="sentChips" class="controls" role="group">
                  <button class="btn btn-secondary" data-val="0">0</button>
                  <button class="btn btn-secondary" data-val="150">150</button>
                  <button class="btn btn-primary" data-val="300">300</button>
                  <button class="btn btn-secondary" data-val="500">500</button>
                </div>
                <input id="sentNum" type="number" min="0" max="2000" step="10" placeholder="ì§ì ‘ ì…ë ¥" style="width:130px" />
              </div>
            </div>

            <div>
              <h3>ë³¼ë¥¨/ì•ˆì „</h3>
              <div class="controls">
                <label style="min-width:120px">ì „ì²´ ìŒëŸ‰ ë§ì¶¤</label>
                <button id="normTgl" class="btn btn-primary" aria-pressed="true">ON</button>
              </div>
              <div class="controls" style="margin-top:6px">
                <label style="min-width:120px">ì¬ì‹œë„</label>
                <div id="retryChips" class="controls" role="group">
                  <button class="btn btn-secondary" data-val="0">0</button>
                  <button class="btn btn-secondary" data-val="1">1</button>
                  <button class="btn btn-primary" data-val="3">3</button>
                  <button class="btn btn-secondary" data-val="5">5</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ì–¸ì–´ ìƒ˜í”Œ -->
        <div class="panel">
          <h2>4) ì–¸ì–´ ìƒ˜í”Œ</h2>
          <div class="controls">
            <label style="min-width:120px">ì–¸ì–´ ì„ íƒ</label>
            <select id="sampleLang"></select>
            <label style="min-width:120px">ìƒ˜í”Œ ë¬¸ì¥</label>
            <input id="sampleText" type="text" class="mono" value="ì•ˆë…•í•˜ì„¸ìš”. ì´ê²ƒì€ ìƒ˜í”Œ ë¬¸ì¥ì…ë‹ˆë‹¤." />
          </div>
          <div class="small" style="margin:8px 0;color:var(--muted)">ì–¸ì–´ë¥¼ ê³ ë¥´ë©´ ì•„ë˜ì— ê·¸ ì–¸ì–´ì˜ ëª©ì†Œë¦¬ë“¤ì´ ì­‰ ë‚˜ì˜µë‹ˆë‹¤. ê° í–‰ì˜ â–¶ë¡œ ë“¤ì–´ë³´ê³ , ë²„íŠ¼ìœ¼ë¡œ ì´ë¦„ ì„¤ì •í‘œì— ë°”ë¡œ ì§€ì •í•  ìˆ˜ ìˆì–´ìš”.</div>
          <div class="list">
            <table class="small" id="voiceTable">
              <thead><tr><th>ì´ë¦„</th><th>ìœ í˜•</th><th>ì„±ë³„</th><th>â–¶</th><th>ê¸°ë³¸ ì´ë¦„ì— ì“°ê¸°</th><th>ì„ íƒ ì´ë¦„ì— ì“°ê¸°</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- API ì„¤ì • & ì„¤ëª…ì„œ -->
    <section class="section">
      <div class="row">
        <!-- API -->
        <div class="panel">
          <h2>5) API ì„¤ì •</h2>
          <div class="controls">
            <label style="min-width:140px" for="apiKey">Google TTS API í‚¤</label>
            <input id="apiKey" type="password" placeholder="AIza... (ë‹¹ì‹ ì˜ í‚¤)" autocomplete="off" />
            <button id="showKeyBtn" class="btn btn-secondary">í‘œì‹œ</button>
            <button id="saveKeyBtn" class="btn btn-primary">ì €ì¥</button>
            <button id="clearKeyBtn" class="btn btn-danger">ì‚­ì œ</button>
            <button id="testBtn" class="btn btn-secondary" style="margin-left:auto">í…ŒìŠ¤íŠ¸</button>
          </div>
          <p class="small" style="margin-top:6px;color:var(--muted)">í‚¤ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. GCP ì½˜ì†”ì—ì„œ Text-to-Speech API í™œì„±í™” â†’ API ì œí•œì—ì„œ TTSë§Œ í—ˆìš© â†’ ë‚´ ë„ë©”ì¸ì„ HTTP referrerë¡œ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
        </div>

        <!-- ì„¤ëª…ì„œ (í•­ìƒ í¼ì¹œ ìƒíƒœ) -->
        <div class="panel">
          <h2>ì„¤ëª…ì„œ</h2>
          <div class="small" style="line-height:1.7">
            <h3>ëª¨ë“œ</h3>
            <ul>
              <li><b>ì¼ë°˜</b>: í•œ ì‚¬ëŒì´ ì­‰ ì½ìŠµë‹ˆë‹¤. (ì´ë¦„ ê´€ë ¨ UI ìˆ¨ê¹€)</li>
              <li><b>ì—­í•  ëŒ€í™”</b>: ì¤„ ì•ì— <code class="mono">ì´ë¦„: ë‚´ìš©</code> ë˜ëŠ” <code class="mono">[ì´ë¦„] ë‚´ìš©</code> í˜•íƒœë¡œ ì“°ë©´, ì´ë¦„ë³„ ëª©ì†Œë¦¬ë¥¼ ì ìš©í•©ë‹ˆë‹¤. <b>ì¤„ë§ˆë‹¤ ê¸°ë³¸ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°</b>ê°€ ONì´ë©´ ê·¸ ì¤„ë§Œ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ì½ê³  ë‹¤ìŒ ì¤„ì€ ê¸°ë³¸ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</li>
              <li><b>ì„¸ë°€ ì¡°ì ˆ(ì „ë¬¸ê°€ìš©)</b>: SSMLì„ ì§ì ‘ ì”ë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ ì°¸ì¡°.</li>
            </ul>

            <h3>SSML ëª…ë ¹(ì „ì²´)</h3>
            <ul>
              <li><code class="mono">&lt;speak&gt;...&lt;/speak&gt;</code> â€” ë£¨íŠ¸ ì»¨í…Œì´ë„ˆ (í•„ìˆ˜)</li>
              <li><code class="mono">&lt;p&gt;</code>, <code class="mono">&lt;s&gt;</code> â€” ë¬¸ë‹¨/ë¬¸ì¥ ê²½ê³„</li>
              <li><code class="mono">&lt;break time="300ms"/&gt;</code> â€” ì‰¬ê¸° (ì˜ˆ: 150ms, 300ms)</li>
              <li><code class="mono">&lt;emphasis level="moderate|strong|reduced"&gt;ê°•ì¡°&lt;/emphasis&gt;</code></li>
              <li><code class="mono">&lt;prosody rate="0.95" pitch="-2st" volume="+2dB"&gt;í…ìŠ¤íŠ¸&lt;/prosody&gt;</code></li>
              <li><code class="mono">&lt;say-as interpret-as="characters|digits|cardinal|ordinal|date|time|telephone"&gt;ê°’&lt;/say-as&gt;</code></li>
              <li><code class="mono">&lt;sub alias="ëŒ€ì²´ ë°œìŒ"&gt;ì›ë¬¸&lt;/sub&gt;</code> â€” ë°œìŒ ë°”ê¾¸ê¸°</li>
              <li><code class="mono">&lt;mark name="S1"/&gt;</code> â€” íƒ€ì„í¬ì¸íŠ¸(ë§ˆì»¤)</li>
            </ul>

            <h3>ê¸´ ê¸€ ìë™ ë‚˜ëˆ”</h3>
            <p>Google TTSëŠ” <b>ìš”ì²­ë‹¹ 5,000ë°”ì´íŠ¸</b> ì œí•œì´ ìˆìŠµë‹ˆë‹¤. <b>í•œê¸€ë§Œ ê¸°ì¤€ ì•½ 1,600ì</b>ë¥¼ ë„˜ê¸°ë©´ ì˜¤ë¥˜/ëŠê¹€ì´ ìƒê¸¸ ìˆ˜ ìˆì–´ <b>ìë™ ë‚˜ëˆ” ON</b>ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>

            <h3>ë¬¸ì œ í•´ê²°</h3>
            <ul>
              <li><b>403/ê¶Œí•œ</b>: TTS API í™œì„±í™”, API ì œí•œì—ì„œ TTS í—ˆìš©, referrerì— ë‚´ ë„ë©”ì¸ ì¶”ê°€</li>
              <li><b>ì¶œë ¥ í˜•ì‹</b>: MP3ê°€ ê°€ì¥ í˜¸í™˜ì´ ì¢‹ìŠµë‹ˆë‹¤.</li>
              <li><b>ì˜¤ë””ì˜¤ê°€ ì§§ê²Œ ì˜ë¦¼</b>: ìë™ ë‚˜ëˆ” ONì¸ì§€ í™•ì¸</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- í•˜ë‹¨ ê´‘ê³  & í‘¸í„° -->
    <div class="ad-space"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3006330103681332" data-ad-slot="3909128617" data-ad-format="auto" data-full-width-responsive="true"></ins></div>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>

    <footer class="site">
      <div class="container footer-row">
        <div class="footer-links">
          <a href="/text/">í…ìŠ¤íŠ¸ ì •ë¦¬</a>
          <a href="/utility/">ì—…ë¬´ ìœ í‹¸</a>
          <a href="/audio/">ì˜¤ë””ì˜¤</a>
          <a href="/privacy/">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>
        </div>
        <div class="small">Â© 2025 Thenaom</div>
      </div>
    </footer>
  </main>

  <!-- ====== ìŠ¤í¬ë¦½íŠ¸ ====== -->
  <script>
    // Theme toggle (ê³µí†µ)
    (function(){
      var btn=document.getElementById('themeToggle'); if(!btn) return;
      function sync(){ var mode=document.documentElement.getAttribute('data-theme')||'light'; btn.setAttribute('aria-pressed', mode==='dark'); btn.querySelector('.icon').textContent = mode==='dark'?'ğŸŒ™':'ğŸŒ'; btn.querySelector('.label').textContent = mode==='dark'?'ë‹¤í¬':'ë¼ì´íŠ¸'; }
      btn.addEventListener('click', function(){ var cur=document.documentElement.getAttribute('data-theme')||'light'; var next=(cur==='dark'?'light':'dark'); document.documentElement.setAttribute('data-theme', next); localStorage.setItem('theme', next); sync();});
      sync();
    })();

    // ===== ìƒíƒœ/ì €ì¥ í‚¤ =====
    const LS={KEY:'gcpKey', ROLES:'rolesV7', MODE:'modeV7', OPTS:'optsV7', SAMPLE:'sampleLangV7'};
    const $=id=>document.getElementById(id);
    const bCount=s=>new TextEncoder().encode(s||'').length;
    const on=(el,ev,fn)=>el&&el.addEventListener(ev,fn);
    const sleep=ms=>new Promise(r=>setTimeout(r,ms));

    // ë¯¸ë‹ˆ API ë°°ì§€
    function updateApiBadge(){
      const has=!!localStorage.getItem(LS.KEY);
      const badge=$('apiBadge'); const txt=$('apiMiniText');
      badge.classList.toggle('btn-primary', has);
      badge.classList.toggle('btn-danger', !has);
      badge.textContent = has? 'API ì €ì¥ë¨' : 'API ì…ë ¥ í•„ìš”';
      txt.textContent = has? 'ì´ ë¸Œë¼ìš°ì €ì— API í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤' : 'API í‚¤ë¥¼ ì €ì¥í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”';
    }

    // ì¹´ìš´í„°
    const editor=$('editor');
    function updateCounter(){ $('counter').textContent = editor.value.length+" ê¸€ì / "+bCount(editor.value)+" ë°”ì´íŠ¸"; }
    on(editor,'input',updateCounter);

    // ëª¨ë“œ
    let mode= localStorage.getItem(LS.MODE)||'dialog';
    function setMode(m){ mode=m; localStorage.setItem(LS.MODE,m); $('modeMini').textContent=(m==='plain'?'ì¼ë°˜':(m==='dialog'?'ì—­í•  ëŒ€í™”':'ì„¸ë°€ ì¡°ì ˆ'));
      document.querySelectorAll('#modeChips .btn').forEach(b=>{ const on=(b.dataset.val===m); b.classList.toggle('btn-primary', on); b.classList.toggle('btn-secondary', !on); b.setAttribute('aria-pressed', on); });
      if(m==='plain'){
        $('modeHint').textContent='ì¼ë°˜: í•œ ì‚¬ëŒì´ ì­‰ ì½ìŠµë‹ˆë‹¤.';
        editor.placeholder='ì˜ˆ: ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì.';
      }else if(m==='dialog'){
        $('modeHint').textContent='ì—­í•  ëŒ€í™”: ì¤„ ì•ì— "ì´ë¦„: ë‚´ìš©" ë˜ëŠ” "[ì´ë¦„] ë‚´ìš©"';
        editor.placeholder='ì˜ˆ: í• ë¨¸ë‹ˆ: ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì.\nì†Œë…„: ì•„ì§ í•  ë§ì´ ìˆì–´ìš”!';
      }else{
        $('modeHint').textContent='ì„¸ë°€ ì¡°ì ˆ: <speak>â€¦</speak> ì— SSML ëª…ë ¹ ì‚¬ìš©';
        editor.placeholder='<speak>ì•ˆë…•í•˜ì„¸ìš”. <break time="300ms"/> ì•ˆë‚´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</speak>';
      }
      // ê°€ì‹œì„±
      $('dialogOptBlock').style.display = (m==='dialog')? 'block':'none';
    }
    document.querySelectorAll('#modeChips .btn').forEach(b=> on(b,'click',()=> setMode(b.dataset.val)));

    // ì¹©/ë²„íŠ¼ ê·¸ë£¹ ê°’
    function setGroup(id,val){ const g=$(id); if(!g) return; g.querySelectorAll('.btn').forEach(b=>{ const on=(b.dataset.val===String(val)); b.classList.toggle('btn-primary', on); b.classList.toggle('btn-secondary', !on); b.setAttribute('aria-pressed', on); }); }
    function getGroup(id){ const g=$(id); if(!g) return null; const a=[...g.querySelectorAll('.btn')].find(b=>b.getAttribute('aria-pressed')==='true'); return a? a.dataset.val : null; }

    // ìë™ ì €ì¥ ì˜µì…˜
    function loadOpts(){ try{ return JSON.parse(localStorage.getItem(LS.OPTS)||'{}'); }catch{ return {}; } }
    function autosave(){ const data={
      enc:getGroup('encChips'), sr:getGroup('srChips'), srNum:$('srNum').value,
      sent:getGroup('sentChips'), sentNum:$('sentNum').value,
      sw:getGroup('switchChips'), swNum:$('switchNum').value,
      norm:$('normTgl').getAttribute('aria-pressed')==='true',
      chunk:$('chunkTgl').getAttribute('aria-pressed')==='true',
      retry:getGroup('retryChips'),
      lineReset:$('lineResetTgl').getAttribute('aria-pressed')==='true'
    }; localStorage.setItem(LS.OPTS, JSON.stringify(data)); }

    // í† ê¸€ ê³µí†µ
    function toggleBtn(btn){ const on = btn.getAttribute('aria-pressed')==='true'; btn.setAttribute('aria-pressed', String(!on)); btn.classList.toggle('btn-primary', !on); btn.classList.toggle('btn-secondary', on); btn.textContent = (!on)? 'ON':'OFF'; autosave(); }

    // Wire
    ['encChips','srChips','sentChips','switchChips','retryChips'].forEach(id=>{
      const g=$(id); if(!g) return; g.querySelectorAll('.btn').forEach(b=> on(b,'click',()=>{ g.querySelectorAll('.btn').forEach(x=>{x.setAttribute('aria-pressed','false'); x.classList.remove('btn-primary'); x.classList.add('btn-secondary');}); b.setAttribute('aria-pressed','true'); b.classList.remove('btn-secondary'); b.classList.add('btn-primary'); autosave(); }));
    });
    ['srNum','sentNum','switchNum'].forEach(id=> on($(id),'input',autosave));
    on($('normTgl'),'click',e=> toggleBtn(e.currentTarget));
    on($('chunkTgl'),'click',e=> toggleBtn(e.currentTarget));
    on($('lineResetTgl'),'click',e=> toggleBtn(e.currentTarget));

    // API í‚¤
    const apiKey=$('apiKey');
    on($('showKeyBtn'),'click',()=>{ apiKey.type = (apiKey.type==='password'?'text':'password'); $('showKeyBtn').textContent = (apiKey.type==='password'?'í‘œì‹œ':'ìˆ¨ê¸°ê¸°'); });
    on($('saveKeyBtn'),'click',()=>{ const v=apiKey.value.trim(); if(!v) return alert('API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); localStorage.setItem(LS.KEY,v); updateApiBadge(); alert('API í‚¤ ì €ì¥ë¨'); loadVoices().then(renderVoiceList); });
    on($('clearKeyBtn'),'click',()=>{ localStorage.removeItem(LS.KEY); updateApiBadge(); alert('API í‚¤ ì‚­ì œë¨'); });
    on($('testBtn'),'click',async()=>{ try{ if(!localStorage.getItem(LS.KEY)) throw new Error('API í‚¤ê°€ ì—†ìŒ'); await loadVoices(); alert('ì •ìƒ: ëª©ì†Œë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤'); }catch(e){ alert('ì‹¤íŒ¨: '+e.message); } });

    // ëª©ì†Œë¦¬ ëª©ë¡
    let VOICES=[]; let voiceIndex={};
    async function loadVoices(){ const key=localStorage.getItem(LS.KEY); if(!key) return; const u=new URL('https://texttospeech.googleapis.com/v1/voices'); u.searchParams.set('key',key); const r=await fetch(u); const j=await r.json(); if(!r.ok) throw new Error(j.error?.message||r.statusText); VOICES=(j.voices||[]).sort((a,b)=> a.name>b.name?1:-1); voiceIndex={}; VOICES.forEach(v=> voiceIndex[v.name]=v); }

    // ì´ë¦„(ì—­í• ) ê´€ë¦¬
    const roleBody=document.querySelector('#roleTable tbody');
    let roles = JSON.parse(localStorage.getItem(LS.ROLES)||'{}');
    function ensureBaseRole(){ if(!roles._){ roles._={voice:'', speed:'100', pitch:'0', vol:'0', lang:'ko-KR', comfy:true}; } }
    function saveRoles(){ localStorage.setItem(LS.ROLES, JSON.stringify(roles)); }
    function roleRow(alias, data){ const tr=document.createElement('tr');
      const langs=[...new Set(VOICES.flatMap(v=> v.languageCodes||[]))].sort();
      const langOpts = langs.map(c=> `<option ${data.lang===c?'selected':''} value="${c}">${c}</option>`).join('');
      const voicesForLang = VOICES.filter(v=> (v.languageCodes||[]).includes(data.lang));
      const vOptions = `<option value="" ${!data.voice?'selected':''}>â€” ì„ íƒ â€”</option>` + (voicesForLang.length? voicesForLang: VOICES).map(v=> `<option ${data.voice===v.name?'selected':''} value="${v.name}">${v.name}</option>`).join('');
      tr.innerHTML = `
        <td class="mono">${alias==='_'? 'ê¸°ë³¸': alias}${!data.voice?'<span style="background:#ef4444;color:#fff;border-radius:6px;padding:1px 6px;margin-left:6px;font-size:11px">ëª©ì†Œë¦¬ ì„ íƒ</span>':''}</td>
        <td><select class="voiceSel">${vOptions}</select></td>
        <td><button class="btn btn-secondary small prevBtn">â–¶</button></td>
        <td>
          <div class="controls"><input class="speedNum" type="number" min="50" max="200" step="1" value="${data.speed}" style="width:90px" />
            <div class="controls"><button class="btn btn-secondary small speedC" data-val="80">ëŠë¦¬ê²Œ</button><button class="btn btn-secondary small speedC" data-val="100">ë³´í†µ</button><button class="btn btn-secondary small speedC" data-val="120">ë¹ ë¥´ê²Œ</button></div>
          </div>
        </td>
        <td>
          <div class="controls"><input class="pitchNum" type="number" min="-12" max="12" step="1" value="${data.pitch}" style="width:90px" />
            <div class="controls"><button class="btn btn-secondary small pitchC" data-val="-2">ë‚®ê²Œ</button><button class="btn btn-secondary small pitchC" data-val="0">ë³´í†µ</button><button class="btn btn-secondary small pitchC" data-val="+2">ë†’ê²Œ</button></div>
          </div>
        </td>
        <td>
          <div class="controls"><input class="volNum" type="number" min="-10" max="10" step="0.1" value="${data.vol}" style="width:90px" />
            <div class="controls"><button class="btn btn-secondary small volC" data-val="-2">ì‘ê²Œ</button><button class="btn btn-secondary small volC" data-val="0">ë³´í†µ</button><button class="btn btn-secondary small volC" data-val="+2">í¬ê²Œ</button></div>
          </div>
        </td>
        <td><button class="btn ${data.comfy?'btn-primary':'btn-secondary'} small comfy" aria-pressed="${data.comfy?'true':'false'}">${data.comfy?'ON':'OFF'}</button></td>
        <td><select class="langSel">${langOpts}</select></td>`;
      tr.querySelector('.prevBtn').onclick=()=>{ const name=tr.querySelector('.voiceSel').value; if(!name) return alert('ë¨¼ì € ëª©ì†Œë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”'); previewVoice(name, tr.querySelector('.langSel').value); };
      tr.querySelector('.voiceSel').onchange=(e)=>{ data.voice=e.target.value; saveRoles(); renderRoles(); };
      tr.querySelector('.langSel').onchange=(e)=>{ data.lang=e.target.value; saveRoles(); renderRoles(); };
      tr.querySelectorAll('.speedC').forEach(b=> b.onclick=()=>{ data.speed=b.dataset.val; tr.querySelector('.speedNum').value=data.speed; saveRoles(); renderRoles(); });
      tr.querySelectorAll('.pitchC').forEach(b=> b.onclick=()=>{ data.pitch=b.dataset.val; tr.querySelector('.pitchNum').value=data.pitch; saveRoles(); renderRoles(); });
      tr.querySelectorAll('.volC').forEach(b=> b.onclick=()=>{ data.vol=b.dataset.val; tr.querySelector('.volNum').value=data.vol; saveRoles(); renderRoles(); });
      tr.querySelector('.speedNum').oninput=(e)=>{ data.speed=String(e.target.value||'100'); saveRoles(); };
      tr.querySelector('.pitchNum').oninput=(e)=>{ data.pitch=String(e.target.value||'0'); saveRoles(); };
      tr.querySelector('.volNum').oninput=(e)=>{ data.vol=String(e.target.value||'0'); saveRoles(); };
      tr.querySelector('.comfy').onclick=(e)=>{ const btn=e.currentTarget; const on=btn.getAttribute('aria-pressed')==='true'; btn.setAttribute('aria-pressed', String(!on)); data.comfy=!on; btn.classList.toggle('btn-primary', !on); btn.classList.toggle('btn-secondary', on); btn.textContent = (!on)?'ON':'OFF'; if(data.comfy){ data.speed='92'; data.pitch='-2'; } saveRoles(); renderRoles(); };
      return tr;
    }
    function renderRoles(){ roleBody.innerHTML=''; ensureBaseRole(); const keys=Object.keys(roles).sort((a,b)=> a==='_'?-1:(b==='_'?1:a.localeCompare(b))); $('roleCount').textContent = `ì´ ${keys.length}ê°œ ì´ë¦„`; keys.forEach(alias=> roleBody.appendChild(roleRow(alias, roles[alias]))); }

    on($('addRoleBtn'),'click',()=>{ const name=prompt('ì¶”ê°€í•  ì´ë¦„ (ì˜ˆ: í• ë¨¸ë‹ˆ)'); if(!name) return; roles[name]={voice:'', speed:'100', pitch:'0', vol:'0', lang:'ko-KR', comfy:false}; saveRoles(); renderRoles(); });
    on($('resetRolesBtn'),'click',()=>{ if(!confirm('ëª¨ë“  ì´ë¦„ ì„¤ì •ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return; roles={}; ensureBaseRole(); saveRoles(); renderRoles(); });

    // ì´ë¦„ ìë™ì°¾ê¸°
    function parseDialogByAlias(text, resetEachLine){ const lines=text.split(/\n/); const parts=[]; let cur='_'; for(const raw of lines){ const line=raw.trim(); if(!line){ parts.push({alias:resetEachLine?'_':cur,text:'\n'}); continue;} let m=line.match(/^([\w\uAC00-\uD7A3]{1,16}):\s*(.*)$/); if(m){ cur=m[1]; parts.push({alias:cur,text:m[2]}); if(resetEachLine) cur='_'; continue;} m=line.match(/^\[([\w\uAC00-\uD7A3]{1,16})\]\s*(.*)$/); if(m){ cur=m[1]; parts.push({alias:cur,text:m[2]}); if(resetEachLine) cur='_'; continue;} parts.push({alias:resetEachLine?'_':cur,text:line}); }
      return parts.filter(p=>p.text&&p.text.trim()); }
    function detectRoles(){ const parts=parseDialogByAlias(editor.value, $('lineResetTgl').getAttribute('aria-pressed')==='true'); const uniq=new Set(parts.map(p=>p.alias)); ensureBaseRole(); uniq.forEach(a=>{ if(!roles[a]) roles[a]={voice:'', speed:'100', pitch:'0', vol:'0', lang:'ko-KR', comfy:(a==='_')}; }); saveRoles(); renderRoles(); alert(uniq.size? `ì°¾ì€ ì´ë¦„: ${[...uniq].join(', ')}`:'ì´ë¦„ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì˜ˆ: "í• ë¨¸ë‹ˆ: ë‚´ìš©"'); }
    on($('detectBtn'),'click',detectRoles);

    // í¸ì§‘ ë„ìš°ë¯¸
    on($('aliasBtn'),'click',()=>{ const name=prompt('ì„ íƒí•œ ë¬¸ì¥ì— ë¶™ì¼ ì´ë¦„ (ì˜ˆ: í• ë¨¸ë‹ˆ)'); if(!name) return; const ta=editor; const s=ta.selectionStart,e=ta.selectionEnd; const before=ta.value.slice(0,s), sel=ta.value.slice(s,e), after=ta.value.slice(e); ta.value = `${before}${name}: ${sel}${after}`; updateCounter(); });
    on($('altBtn'),'click',()=>{ const A=prompt('ì²« ì¤„ ì´ë¦„(ì˜ˆ: A)'), B=prompt('ë‹¤ìŒ ì¤„ ì´ë¦„(ì˜ˆ: B)'); if(!A||!B) return; const lines=editor.value.split(/\n/); let cur=A; for(let i=0;i<lines.length;i++){ if(lines[i].trim()){ lines[i]=`${cur}: `+lines[i]; cur=(cur===A?B:A);} } editor.value=lines.join('\n'); updateCounter(); });

    // ì–¸ì–´ ìƒ˜í”Œ
    const LANG_SAMPLES=[
      { code:'ko-KR', name:'í•œêµ­ì–´(ëŒ€í•œë¯¼êµ­)', sample:'ì•ˆë…•í•˜ì„¸ìš”. ì´ê²ƒì€ ìƒ˜í”Œ ë¬¸ì¥ì…ë‹ˆë‹¤.' },
      { code:'en-US', name:'ì˜ì–´(ë¯¸êµ­)', sample:'Hello, this is a sample sentence.' },
      { code:'en-GB', name:'ì˜ì–´(ì˜êµ­)', sample:'Hello, this is a sample sentence.' },
      { code:'ja-JP', name:'ì¼ë³¸ì–´', sample:'ã“ã‚“ã«ã¡ã¯ã€‚ã“ã‚Œã¯ã‚µãƒ³ãƒ—ãƒ«æ–‡ã§ã™ã€‚' },
      { code:'zh-CN', name:'ì¤‘êµ­ì–´(ì¤‘êµ­ í‘œì¤€)', sample:'ä½ å¥½ã€‚è¿™æ˜¯ä¸€å¥ç¤ºä¾‹å¥å­ã€‚' },
      { code:'zh-TW', name:'ì¤‘êµ­ì–´(ëŒ€ë§Œ)', sample:'ä½ å¥½ã€‚é€™æ˜¯ä¸€å¥ç¯„ä¾‹ã€‚' },
      { code:'de-DE', name:'ë…ì¼ì–´', sample:'Hallo, dies ist ein Beispielsatz.' },
      { code:'fr-FR', name:'í”„ë‘ìŠ¤ì–´', sample:'Bonjour, ceci est une phrase exemple.' },
      { code:'es-ES', name:'ìŠ¤í˜ì¸ì–´(ìŠ¤í˜ì¸)', sample:'Hola, esta es una frase de ejemplo.' },
      { code:'it-IT', name:'ì´íƒˆë¦¬ì•„ì–´', sample:'Ciao, questa Ã¨ una frase di esempio.' },
      { code:'ru-RU', name:'ëŸ¬ì‹œì•„ì–´', sample:'Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ. Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ.' },
      { code:'pt-BR', name:'í¬ë¥´íˆ¬ê°ˆì–´(ë¸Œë¼ì§ˆ)', sample:'OlÃ¡, esta Ã© uma frase de exemplo.' }
    ];
    const voiceBody = document.querySelector('#voiceTable tbody');
    function renderSample(){ const sel=$('sampleLang'); sel.innerHTML = LANG_SAMPLES.map(x=>`<option value="${x.code}">${x.name} â€” ${x.code}</option>`).join(''); const saved=localStorage.getItem(LS.SAMPLE); sel.value = saved || 'ko-KR'; const it=LANG_SAMPLES.find(x=>x.code===sel.value); if(it) $('sampleText').value=it.sample; renderVoiceList(); }
    on($('sampleLang'),'change',()=>{ localStorage.setItem(LS.SAMPLE, $('sampleLang').value); const it=LANG_SAMPLES.find(x=>x.code===$('sampleLang').value); if(it) $('sampleText').value=it.sample; renderVoiceList(); });
    function renderVoiceList(){ voiceBody.innerHTML=''; const lang=$('sampleLang').value; const list=VOICES.filter(v=> (v.languageCodes||[]).includes(lang)); list.forEach(v=>{ const tr=document.createElement('tr'); tr.innerHTML=`
        <td class="mono">${v.name}</td>
        <td>${/Neural|Wavenet|Chirp|Standard/i.test(v.name)? (v.name.match(/(Chirp|Neural|Wavenet|Standard)/i)||['',''])[1] : 'â€”'}</td>
        <td>${v.ssmlGender||'â€”'}</td>
        <td><button class="btn btn-secondary small prevBtn">â–¶</button></td>
        <td><button class="btn btn-secondary small useBase">ê¸°ë³¸ ì´ë¦„</button></td>
        <td><button class="btn btn-secondary small useSelected">ì„ íƒ ì´ë¦„â€¦</button></td>`;
      tr.querySelector('.prevBtn').onclick=()=> previewVoice(v.name, lang, $('sampleText').value);
      tr.querySelector('.useBase').onclick=()=>{ ensureBaseRole(); roles._.lang=lang; roles._.voice=v.name; saveRoles(); renderRoles(); alert('ê¸°ë³¸ ì´ë¦„ì— ì ìš©ë¨'); };
      tr.querySelector('.useSelected').onclick=()=>{ const keys=Object.keys(roles); if(!keys.length){ alert('ë¨¼ì € ì´ë¦„ì„ ì¶”ê°€í•˜ì„¸ìš”'); return; } const name=prompt('ì–´ëŠ ì´ë¦„ì— ì“¸ê¹Œìš”? '+keys.join(', ')); if(!name||!roles[name]) return; roles[name].lang=lang; roles[name].voice=v.name; saveRoles(); renderRoles(); alert(`${name}ì— ì ìš©ë¨`); };
      voiceBody.appendChild(tr); }); }

    // í•©ì„±
    function chipsVal(id){ return getGroup(id); }
    function numOrChip(numEl, chipId){ const v=numEl.value.trim(); return v? Number(v) : Number(chipsVal(chipId)); }
    const MAX_BYTES=4900; // ì•ˆì „ ë§ˆì§„
    function splitChunks(text){ const out=[]; const paras=text.split(/\n{2,}/); for(const para of paras){ if(!para.trim()) continue; if(bCount(para)<=MAX_BYTES){ out.push(para); continue;} const sents=para.split(/(?<=[\.\!\?â€¦]|[ã€‚ï¼ï¼Ÿ])\s+/); let buf=''; for(const s of sents){ const cand=buf? (buf+' '+s):s; if(bCount(cand)>MAX_BYTES){ if(buf) out.push(buf); if(bCount(s)>MAX_BYTES){ let cur=s; while(bCount(cur)>MAX_BYTES){ let take=Math.floor(cur.length*0.6); while(take<cur.length && bCount(cur.slice(0,take))<=MAX_BYTES) take++; out.push(cur.slice(0,take-1)); cur=cur.slice(take-1);} if(cur.trim()) buf=cur; else buf=''; } else { buf=s; } } else { buf=cand; } } if(buf.trim()) out.push(buf);} return out; }
    function insertBreaks(str, ms){ if(!ms||ms==='0') return str; const parts=str.split(/(?<=[\.\!\?â€¦]|[ã€‚ï¼ï¼Ÿ])\s+/); return parts.join(` <break time=\"${ms}ms\"/> `); }

    async function synthesizeChunk({text, useSSML, voiceName, languageCode, rate, pitch, vol, encoding, sampleRate}){
      const key=localStorage.getItem(LS.KEY); if(!key) throw new Error('API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤');
      const input = useSSML? { ssml:`<speak>${text}</speak>` } : { text };
      const voice={ languageCode }; if(voiceName) voice.name=voiceName;
      const body={ input, voice, audioConfig:{ audioEncoding: encoding, speakingRate: rate, pitch: pitch, volumeGainDb: vol, sampleRateHertz: sampleRate } };
      const url=`https://texttospeech.googleapis.com/v1/text:synthesize?key=${encodeURIComponent(key)}`;
      const retries = Number(getGroup('retryChips')||'0');
      for(let attempt=0; attempt<=retries; attempt++){
        const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
        const j=await r.json(); if(r.ok) return j.audioContent; if(attempt===retries) throw new Error(j.error?.message||r.statusText); await sleep(300*(attempt+1));
      }
    }
    function b64ToU8(b64){ const bin=atob(b64); const u8=new Uint8Array(bin.length); for(let i=0;i<bin.length;i++) u8[i]=bin.charCodeAt(i); return u8; }
    function concatU8(arrs){ const n=arrs.reduce((s,a)=>s+a.length,0); const out=new Uint8Array(n); let off=0; for(const a of arrs){ out.set(a,off); off+=a.length;} return out; }

    async function previewVoice(name, lang, sample){ try{ const b64=await synthesizeChunk({text: sample||'ì•ˆë…•í•˜ì„¸ìš”. ë¯¸ë¦¬ë“£ê¸°ì…ë‹ˆë‹¤.', useSSML:false, voiceName:name, languageCode:lang||'ko-KR', rate:1.0, pitch:0, vol:0, encoding:'MP3', sampleRate:Number($('srNum').value||chipsVal('srChips')||44100)}); const url=URL.createObjectURL(new Blob([b64ToU8(b64)],{type:'audio/mpeg'})); new Audio(url).play(); }catch(e){ alert('ë¯¸ë¦¬ë“£ê¸° ì‹¤íŒ¨: '+e.message);} }

    function buildSegments(){ const text=editor.value; const enc=chipsVal('encChips')||'MP3'; const sr=Number($('srNum').value||chipsVal('srChips')||'44100'); const sp=String(numOrChip($('sentNum'),'sentChips')||300); const sw=String(numOrChip($('switchNum'),'switchChips')||150); const lineReset= $('lineResetTgl').getAttribute('aria-pressed')==='true'; const chunkOn=$('chunkTgl').getAttribute('aria-pressed')==='true';
      const segs=[]; const splitter = chunkOn? splitChunks: (t)=>[t];
      if(mode==='ssml'){
        const chunks= splitter(text);
        const base = roles._ || {voice:'', speed:'100', pitch:'0', vol:'0', lang:'ko-KR'};
        chunks.forEach(ch=> segs.push({ alias:'ê¸°ë³¸', text: ch, ssml:true, voice: base.voice, lang: base.lang, rate: Number(base.speed)/100, pitch: Number(base.pitch), vol: Number(base.vol) }));
      } else if(mode==='plain'){
        const base = roles._ || {voice:'', speed:'100', pitch:'0', vol:'0', lang:'ko-KR'};
        const inner = insertBreaks(text, sp);
        splitter(inner).forEach(ch=> segs.push({ alias:'ê¸°ë³¸', text: ch, ssml:true, voice: base.voice, lang: base.lang, rate: Number(base.speed)/100, pitch: Number(base.pitch), vol: Number(base.vol) }));
      } else { // dialog
        const parts = parseDialogByAlias(text, lineReset);
        for(let i=0;i<parts.length;i++){
          const cur=parts[i], next=parts[i+1];
          const add = (next && next.alias!==cur.alias)? ` <break time=\"${sw}ms\"/>` : '';
          const r = roles[cur.alias] || roles._ || {voice:'', speed:'100', pitch:'0', vol:'0', lang:'ko-KR'};
          const inner = insertBreaks(cur.text, sp) + add;
          splitter(inner).forEach(ch=> segs.push({ alias: cur.alias, text: ch, ssml:true, voice: r.voice, lang: r.lang, rate: Number(r.speed)/100, pitch: Number(r.pitch), vol: Number(r.vol) }));
        }
      }
      return {segs, enc, sr};
    }

    let segmentsLog=[];
    on($('makeBtn'),'click', async ()=>{
      if(!localStorage.getItem(LS.KEY)) return alert('ë¨¼ì € API í‚¤ë¥¼ ì €ì¥í•˜ì„¸ìš”');
      if(VOICES.length===0) await loadVoices();
      if(mode!=='ssml'){
        if(mode==='plain'){ if(!(roles._ && roles._.voice)) return alert('ì¼ë°˜ ëª¨ë“œ: ê¸°ë³¸ ì´ë¦„ì˜ ëª©ì†Œë¦¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”'); }
        if(mode==='dialog'){
          const missing=[]; Object.keys(roles).forEach(k=>{ if(!roles[k].voice) missing.push(k); }); if(missing.length>0) return alert('ì•„ë˜ ì´ë¦„ ì„¤ì •í‘œì—ì„œ ëª©ì†Œë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”:\n'+missing.join(', '));
        }
      }
      $('makeBtn').disabled=true; $('status').textContent='ì‹œì‘í•©ë‹ˆë‹¤â€¦';
      try{
        const {segs, enc, sr} = buildSegments();
        const parts=[]; segmentsLog=[];
        for(let i=0;i<segs.length;i++){
          $('status').textContent = `ë§Œë“œëŠ” ì¤‘â€¦ (${i+1}/${segs.length})`;
          const s=segs[i];
          const b64= await synthesizeChunk({text:s.text, useSSML:s.ssml, voiceName:s.voice, languageCode:s.lang, rate:s.rate, pitch:s.pitch, vol:s.vol, encoding:enc, sampleRate:sr});
          const u8=b64ToU8(b64); parts.push(u8);
          segmentsLog.push({ alias:s.alias, text: s.text.replace(/\s+/g,' ').slice(0,80), dur: 0 });
          await sleep(8);
        }
        const bytes=concatU8(parts); const mime=(enc==='OGG_OPUS'?'audio/ogg':'audio/mpeg'); const url=URL.createObjectURL(new Blob([bytes],{type:mime}));
        $('player').src=url; const name=`tts-output-${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.${enc==='OGG_OPUS'?'ogg':'mp3'}`; const dl=$('download'); dl.style.display='inline'; dl.href=url; dl.download=name; $('outInfo').textContent=`${(bytes.length/1024).toFixed(1)} KB Â· ${segs.length} ì¡°ê°`; $('status').textContent='ì™„ë£Œ';
      }catch(e){ console.error(e); alert('ì˜¤ë¥˜: '+e.message); $('status').textContent='ì‹¤íŒ¨'; }
      $('makeBtn').disabled=false;
    });

    function toSrt(){ let t=0, out='', i=1; for(const seg of segmentsLog){ const fmt=(x)=>{ const h=String(Math.floor(x/3600)).padStart(2,'0'); x%=3600; const m=String(Math.floor(x/60)).padStart(2,'0'); const s=String(Math.floor(x%60)).padStart(2,'0'); const ms=String(Math.floor((x%1)*1000)).padStart(3,'0'); return `${h}:${m}:${s},${ms}`}; const s=fmt(t), e=fmt(t+(seg.dur||0)); out+=`${i++}\n${s} --> ${e}\n${seg.alias?('['+seg.alias+'] '):''}${seg.text}\n\n`; t+=(seg.dur||0);} return out; }
    function toVtt(){ let t=0, out='WEBVTT\n\n'; for(const seg of segmentsLog){ const fmt=(x)=>{ const h=String(Math.floor(x/3600)).padStart(2,'0'); x%=3600; const m=String(Math.floor(x/60)).padStart(2,'0'); const s=String(Math.floor(x%60)).padStart(2,'0'); const ms=String(Math.floor((x%1)*1000)).padStart(3,'0'); return `${h}:${m}:${s}.${ms}`}; const s=fmt(t), e=fmt(t+(seg.dur||0)); out+=`${s} --> ${e}\n${seg.alias?('['+seg.alias+'] '):''}${seg.text}\n\n`; t+=(seg.dur||0);} return out; }
    function downloadText(name, text){ const url=URL.createObjectURL(new Blob([text],{type:'text/plain;charset=utf-8'})); const a=document.createElement('a'); a.href=url; a.download=name; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 80); }
    on($('srtBtn'),'click',()=>{ if(!segmentsLog.length) return alert('ë¨¼ì € ìŒì„±ì„ ë§Œë“œì„¸ìš”'); downloadText('subtitles.srt', toSrt()); });
    on($('vttBtn'),'click',()=>{ if(!segmentsLog.length) return alert('ë¨¼ì € ìŒì„±ì„ ë§Œë“œì„¸ìš”'); downloadText('subtitles.vtt', toVtt()); });

    // ì´ˆê¸°í™”
    (async function init(){ updateApiBadge(); setMode(mode); const o=JSON.parse(localStorage.getItem(LS.OPTS)||'{}');
      // ì˜µì…˜ ë³µì›
      setGroup('encChips', o.enc||'MP3'); setGroup('srChips', o.sr||'44100'); $('srNum').value=o.srNum||''; setGroup('sentChips', o.sent||'300'); $('sentNum').value=o.sentNum||''; setGroup('switchChips', o.sw||'150'); $('switchNum').value=o.swNum||''; $('normTgl').setAttribute('aria-pressed', String(o.norm!==false)); $('normTgl').classList.toggle('btn-primary', o.norm!==false); $('normTgl').classList.toggle('btn-secondary', o.norm===false); $('normTgl').textContent=(o.norm===false?'OFF':'ON'); $('chunkTgl').setAttribute('aria-pressed', String(o.chunk!==false)); $('chunkTgl').classList.toggle('btn-primary', o.chunk!==false); $('chunkTgl').classList.toggle('btn-secondary', o.chunk===false); $('chunkTgl').textContent=(o.chunk===false?'OFF':'ON'); $('lineResetTgl').setAttribute('aria-pressed', String(o.lineReset!==false)); $('lineResetTgl').classList.toggle('btn-primary', o.lineReset!==false); $('lineResetTgl').classList.toggle('btn-secondary', o.lineReset===false); $('lineResetTgl').textContent=(o.lineReset===false?'OFF':'ON');
      await loadVoices(); ensureBaseRole(); renderRoles(); renderSample(); updateCounter(); autosave(); })();
  </script>
  <script src="assets/js/tts-dialog.js"></script>
</body>
</html>
