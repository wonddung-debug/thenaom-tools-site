<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>바이트 단위 텍스트 분할 | 경계 우선 · 근처값 · UTF-8 안전 (Thenaom Tools)</title>
  <meta name="description" content="UTF-8 기준 원하는 바이트로 텍스트를 분할합니다. 공백/문장끝/마침표 경계를 우선하고, 한도보다 작은 근처값을 찾아 깔끔하게 자릅니다. 이모지/한글 안전.">
  <link rel="canonical" href="https://tools.thenaom.com/tools/byte-split.html">
  <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>
<header class="site">
  <div class="container" style="display:flex;gap:16px;align-items:center;justify-content:space-between">
    <a class="brand" href="/">Thenaom Tools</a>
    <nav><ul><li><a href="/text/">텍스트 정리</a></li><li><a class="active" href="/convert/">분할/변환</a></li><li><a href="/utility/">유틸</a></li></ul></nav>
  </div>
</header>

<section class="hero"><div class="container">
  <h1>바이트 단위 텍스트 분할</h1>
  <p class="muted">UTF-8 기준 · 경계 우선 · 근처값 탐색 · 브라우저에서만 처리</p>
</div></section>

<div class="container">
  <div class="ad-placeholder"><b>광고 자리</b><small>AdSense 승인 후 코드 (naom_bytesplit_top)</small></div>

  <section class="card" style="margin-bottom:16px">
    <div class="row" style="flex-wrap:wrap;gap:12px;align-items:center">
      <label>조각 최대 바이트: <input id="limit" type="number" min="1" value="500"></label>
      <label><input type="checkbox" id="preferDot"> 마침표(.) 우선</label>
      <label><input type="checkbox" id="preferSentence" checked> 문장 끝 우선</label>
      <label><input type="checkbox" id="preferWhitespace" checked> 공백 경계 우선</label>
      <label>근처값 탐색 범위: <input id="window" type="number" min="0" value="60"></label>
      <span id="stat" class="muted">입력 0바이트</span>
    </div>

    <div class="row" style="margin-top:8px">
      <label>조각 사이 구분자:
        <select id="separatorSelect">
          <option value="\n">줄바꿈</option>
          <option value="\n\n">빈 줄</option>
          <option value="\n---\n" selected>--- (구분선)</option>
          <option value="">없음</option>
          <option value="custom">사용자 지정</option>
        </select>
      </label>
      <input id="separatorCustom" type="text" placeholder="예: ### 또는 \n***\n" style="display:none;min-width:180px">
      <span id="sepPreview" class="muted">예시: [조각1]↵---↵[조각2]</span>
    </div>

    <div class="row" style="margin-top:8px">
      <button class="btn" id="run">분할 실행</button>
      <button class="btn secondary" id="copyAll">전체 복사</button>
      <button class="btn secondary" id="downloadAll">텍스트 다운로드</button>
      <button class="btn secondary" id="clear">모두 지우기</button>
    </div>
  </section>

  <div class="grid cols2">
    <article class="card">
      <h2>입력</h2>
      <textarea id="input" placeholder="긴 텍스트를 붙여 넣으세요. UTF-8 바이트 기준으로 분할합니다."></textarea>
    </article>
    <article class="card">
      <h2>결과</h2>
      <div id="summary" class="muted" style="margin-bottom:6px"></div>
      <div id="result" class="list" aria-live="polite"></div>
    </article>
  </div>

  <div class="ad-placeholder"><b>광고 자리</b><small>AdSense 승인 후 코드 (naom_bytesplit_bottom)</small></div>

  <h2 class="section-title">관련 도구</h2>
  <div class="grid cols2">
    <article class="card"><h2>글자/단어/바이트 카운터</h2><p>실시간 텍스트 길이 측정.</p><a class="btn" href="/tools/counter.html">열기</a></article>
    <article class="card"><h2>줄바꾸기 · 줄바꿈 제거</h2><p>구분자 기준 줄바꿈 추가/모두 제거.</p><a class="btn" href="/tools/linebreak.html">열기</a></article>
  </div>
</div>

<footer class="site"><div class="container">© <span id="y"></span> Thenaom Tools</div></footer>
<script>document.getElementById('y').textContent=new Date().getFullYear();</script>

<script>
/* 원본 로직 유지, 불필요 코드 정리됨 */
const $=s=>document.querySelector(s);
const encoder=new TextEncoder();
const byteLen=s=>encoder.encode(s).length;
const norm=s=>s.replace(/\r\n/g,'\n').replace(/\r/g,'\n');
const SENT_END=/[.!?…]/, CLOSE=/[”'")\]\}]/;

function buildByteMap(s){
  const map=[0];let acc=0;
  for(let i=0;i<s.length;){
    const cp=s.codePointAt(i),ch=String.fromCodePoint(cp);
    acc+=byteLen(ch);i+=ch.length;map[i]=acc;
  }
  for(let i=1;i<=s.length;i++) if(map[i]===undefined) map[i]=map[i-1];
  return map;
}
function findBestCut(s,limit,win,prefs){
  if(!s.length) return 0;
  const map=buildByteMap(s);
  let hard=0;for(let i=0;i<map.length;i++){if(map[i]<=limit) hard=i;else break;}
  if(!hard) return 0;
  const min=Math.max(1,limit-win),cands=[];
  for(let i=1;i<map.length;i++){if(map[i]>=min&&map[i]<=limit)cands.push(i);if(map[i]>limit)break;}
  if(!cands.length) return hard;
  const tests=[];if(prefs.dot)tests.push(i=>s[i-1]==='.');if(prefs.sentence)tests.push(i=>{const p=s[i-1]||'';if(SENT_END.test(p))return true;if(CLOSE.test(p)){const p2=s[i-2]||'';if(SENT_END.test(p2))return true;}return false;});if(prefs.whitespace)tests.push(i=>/\s/.test(s[i-1]||''));
  for(const t of tests){for(let k=cands.length-1;k>=0;k--){if(t(cands[k]))return cands[k];}}
  return hard;
}
function splitSmart(input,limit,win,prefs){
  const chunks=[];let rest=norm(input);
  while(rest.length){
    const first=String.fromCodePoint(rest.codePointAt(0));
    if(byteLen(first)>limit){chunks.push(first);rest=rest.slice(first.length);continue;}
    const cut=findBestCut(rest,limit,win,prefs);
    if(cut<=0){let acc=0,i=0;while(i<rest.length){const ch=String.fromCodePoint(rest.codePointAt(i)),b=byteLen(ch);if(acc+b>limit)break;acc+=b;i+=ch.length;}chunks.push(rest.slice(0,i));rest=rest.slice(i);}
    else{chunks.push(rest.slice(0,cut));rest=rest.slice(cut);}
  }return chunks;
}
function interpretEscapes(s){return s.replace(/\\n/g,'\n').replace(/\\t/g,'\t').replace(/\\r/g,'\r');}
function getSep(){const sel=$('#separatorSelect').value;if(sel==='custom')return interpretEscapes($('#separatorCustom').value||'');return interpretEscapes(sel);}
function updateSepPreview(){const raw=$('#separatorSelect').value;$('#separatorCustom').style.display=raw==='custom'?'':'none';const sep=getSep();$('#sepPreview').textContent=`예시: [조각1]${sep.replace(/\n/g,'↵')}[조각2]`;}
function renderChunks(chunks){const c=$('#result');c.innerHTML='';chunks.forEach((t,i)=>{const b=byteLen(t);c.innerHTML+=`<div class="chunk"><div class="meta">조각 ${i+1} (${b}B) <button class="btn secondary" onclick="navigator.clipboard.writeText(\`${t}\`)">복사</button></div><div class="content" style="white-space:pre-wrap;word-break:break-word">${t.replace(/[&<>]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]))}</div></div>`;});}
function run(){const v=$('#input').value||'',limit=Math.max(1,+$('#limit').value||1),win=Math.max(0,+$('#window').value||0);const prefs={dot:$('#preferDot').checked,sentence:$('#preferSentence').checked,whitespace:$('#preferWhitespace').checked};const chunks=splitSmart(v,limit,win,prefs);renderChunks(chunks);$('#summary').textContent=`총 ${byteLen(v)}B / ${chunks.length}조각`;$('#stat').textContent=`입력 ${byteLen(v)}바이트`;updateSepPreview();}
$('#run').addEventListener('click',run);$('#copyAll').addEventListener('click',()=>navigator.clipboard.writeText([...document.querySelectorAll('.chunk .content')].map(x=>x.textContent).join(getSep())));$('#downloadAll').addEventListener('click',()=>{const text=[...document.querySelectorAll('.chunk .content')].map(x=>x.textContent).join(getSep());const blob=new Blob([text],{type:'text/plain;charset=utf-8'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='byte-split.txt';a.click();URL.revokeObjectURL(a.href);});$('#clear').addEventListener('click',()=>{$('#input').value='';$('#result').innerHTML='';$('#summary').textContent='';$('#stat').textContent='입력 0바이트';});$('#input').addEventListener('input',()=>$('#stat').textContent=`입력 ${byteLen($('#input').value)}바이트`);$('#separatorSelect').addEventListener('change',updateSepPreview);$('#separatorCustom').addEventListener('input',updateSepPreview);updateSepPreview();
</script>
</body>
</html>
